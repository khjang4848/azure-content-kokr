<properties
	pageTitle="Resource Manager 템플릿의 패턴 | Microsoft Azure"
	description="Azure 리소스 관리자 템플릿에 대한 설계 패턴 표시"
	services="azure-resource-manager"
	documentationCenter=""
	authors="tfitzmac"
	manager="timlt"
	editor="tysonn"/>

<tags
	ms.service="azure-resource-manager"
	ms.workload="multiple"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="09/12/2016"
	ms.author="tomfitz"/>

# Azure Resource Manager 템플릿 설계의 패턴

엔터프라이즈, 시스템 통합 업체(SI), 클라우드 서비스 업체(CSV), 및 오픈 소스 소프트웨어(OSS) 프로젝트 팀과의 작업에서 환경는, 워크로드 또는 배율 단위를 신속하게 배포해야 하는 경우가 빈번합니다. 이러한 배포는 지원되어야 하고 검증된 작업 방식을 따라야 하며 관련 정책을 준수해야 합니다. Azure Resource Manager 템플릿을 기반으로 유연한 접근 방식을 사용하면 복잡한 토폴로지를 신속하고 일관되게 배포할 수 있습니다. 코어 제품이 진화함에 따라 또는 이상값 시나리오나 고객에 대한 변화를 수용할 수 있도록 이러한 배포를 쉽게 조정할 수 있습니다.

이 항목은 더 큰 백서의 일부입니다. 전체 문서를 읽으려면 [세계적 수준의 Azure Resource Manager 템플릿 고려 사항 및 입증된 사례](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf)를 다운로드합니다.

템플릿은 기본 Azure 리소스 관리자의 이점과 JSON(JavaScript Object Notation)의 적응성 및 가독성을 결합합니다. 템플릿을 사용하여 가능한 작업:

- 토폴로지 및 토폴로지의 워크로드를 일관되게 배포합니다.
- 리소스 그룹을 사용하여 하나의 응용 프로그램에서 모든 리소스를 함께 관리합니다.
- 사용자, 그룹 및 서비스에 적합한 액세스를 허용하도록 역할 기반 액세스 제어(RBAC)를 적용합니다.
- 태그 지정 연결을 사용하여 청구 롤업과 같은 작업을 간소화합니다.

이 문서는 Azure 고객 자문 팀(AzureCAT) 고객과의 실제 환경 템플릿 구현 및 설계 세션 중에 확인된 소비 시나리오, 아키텍처, 및 구현 패턴에 대해 자세한 내용을 제공합니다. 이러한 접근 방식은 학술적이지는 않았지만 Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise powered by Apache Cassandra, Elasticsearch, Jenkins, MongoDB, Nagios, PostgreSQL, Redis 및 Nagios를 비롯한 상위 Linux 기반 OSS 기술 중 12가지에 대한 템플릿의 개발을 통해 알려진 검증된 작업 방식입니다. 대부분의 이러한 템플릿은 잘 알려진 특정 배포 공급업체와 함께 개발되었고 최근 프로젝트를 진행하는 동안 Microsoft의 엔터프라이즈 및 SI 고객에 대한 요구 사항의 영향을 받았습니다.

이 문서는 최고 수준의 Azure 리소스 관리자 템플릿을 구성하는데 도움을 주기 위하여 검증된 작업 방식을 공유합니다.

고객과의 작업에서 엔터프라이즈, SI(시스템 통합자) 및 CSV의 몇몇 Resource Manager 템플릿 소비 경험을 확인했습니다. 다음 섹션은 다양한 유형의 고객에 대한 일반적인 시나리오와 패턴의 대략적인 개요를 제공합니다.

## 엔터프라이즈 및 시스템 통합 업체

큰 조직에는 일반적으로 두 가지 Resource Manager 템플릿 소비자(내부 소프트웨어 개발 팀 및 기업 IT)가 있습니다. SI용 시나리오는 엔터프라이즈용 시나리오에 매핑되므로 동일한 고려 사항이 적용됩니다.

### 내부 소프트웨어 개발 팀

템플릿은 비즈니스를 지원하는 소프트웨어를 개발하는 팀에게 비즈니스 특유의 솔루션에 사용하기 위한 기술을 신속하게 배포할 수 있는 쉬운 방법을 제공합니다. 템플릿을 사용하여 팀 멤버가 필요한 기량을 습득할 수 있는 교육 환경을 신속하게 만들 수도 있습니다.

템플릿을 있는 그대로 사용하거나 요구에 맞게 확장 또는 작성할 수 있습니다. 템플릿 내에서 태그 지정을 사용하면 팀, 프로젝트, 개인 및 교육과 같은 다양한 보기로 청구 요약을 제공할 수 있습니다.

소프트웨어 개발 팀은 환경 내 특정 항목이 고정된 상태로 유지되어 재정의 될 수 없도록 제약 조건을 제공하면서도 일관적으로 솔루션을 배포하기 위한 템플릿을 만들어야 하는 경우가 있습니다. 예를 들어 은행의 경우 프로그래머가 개인 저장소 계정에 데이터를 보내기 위해 뱅킹 솔루션을 변경할 수 없도록 템플릿에 RBAC를 포함시켜야 합니다.

### 기업 IT

기업 IT 조직은 일반적으로 클라우드 용량 및 클라우드 호스티드 기능을 제공하기 위한 템플릿을 사용합니다.

#### 클라우드 용량

기업 IT 그룹이 팀을 대상으로 클라우드 용량을 제공하는 일반적은 방법에는 "티셔츠 크기" 개념을 사용하는데 이것은 대, 중, 소와 같은 표준 제품 크기를 의미합니다. 티셔츠 크기의 제품은 템플릿 사용이 가능하도록 일정 수준의 표준화를 제공하면서 다양한 리소스 유형과 수량을 혼합할 수 있습니다. 템플릿은 기업 정책을 적용하는 일관된 방식으로 용량을 제공하고 소비 조직에 환불을 제공하기 위하여 태그 지정을 사용합니다.

예를 들어 소프트웨어 개발 팀이 솔루션을 배포할 수 있는 환경 내에 개발, 테스트 또는 프러덕션 환경을 제공해야 하는 경우가 있습니다. 환경에는 공용 인터넷 및 패킷 검사에 대한 액세스를 관리하는 규칙과 같이 소프트웨어 개발 팀이 변경할 수 없는 미리 정의된 네트워크 토폴로지와 요소가 있습니다. 환경에 대해 뚜렷한 액세스 권한을 소유하는 환경에 대한 조직 고유한 역할이 있을 수도 있습니다.

#### 클라우드 호스티드 기능

템플릿을 사용하여 비즈니스 내부 회선에 제공되는 복합 제품이나 개인 소프트웨어 패키지를 비롯한 클라우드 호스티드 기능을 지원할 수 있습니다. 복합 제품의 예에는 미리 정의된 네트워크 토폴로지에 최적화되어 연결된 구성으로 제공되는 Analytics-as-a-service(분석, 시각화 및 기타 기술)가 있습니다.

클라우드 호스티드 기능은 아래 설명에 따라 제공되는 클라우드 용량 제품에 설정된 보안 및 역할 고려 사항의 영향을 받습니다. 이러한 기능은 있는 그대로 제공되거나 관리 서비스로 제공됩니다. 후자의 경우 관리를 목적으로 환경에 액세스 할 수 있도록 하기 위해 액세스 제한 역할이 필요합니다.

## 클라우드 서비스 공급업체

많은 CSV와의 논의 끝에 관련 요구 사항 및 고객을 위한 서비스를 배포하기 위해 취할 수 있는 여러 가지 접근 방식을 확인했습니다.

### CSV 호스티드 제품

사용자가 소유하는 Azure 구독 내에 제품을 호스트하는 경우 두 가지 호스팅 접근 방식이 일반적이며, 모든 고객을 위한 고유한 배포를 수행하거나 모든 고객에 대해 사용되는 공유 인프라의 기초가 되는 배율 단위를 배포합니다.

- **각 고객에 대한 고유한 배포.** 고객 당 고유한 배포에는 알려져 있는 다양한 구성에 대한 고정 토폴로지가 필요합니다. 이러한 배포를 통해 다양한 VM(가상 컴퓨터) 크기, 다양한 수의 노드, 다양한 크기의 관련 저장소가 포함될 수 있습니다. 배포 태그 지정은 각 고객의 롤업 청구에 사용됩니다. RBAC는 고객이 소유하는 클라우드 환경에 액세스하도록 허용하기 위해 사용될 수 있습니다.
- **공유 다중 테넌트 환경의 배율 단위.** 템플릿은 다중 테넌트 환경에 대한 배율 단위를 나타낼 수 있습니다. 이런 경우 동일한 인프라가 모든 고객을 지원하는데 사용됩니다. 배포는 사용자 수 및 트랜잭션 수와 같이 호스팅되는 제품에 대한 용량 수준을 제공하는 리소스 그룹을 나타냅니다. 이러한 배율 단위는 요구 사항의 필요에 따라서 증가되거나 감소됩니다.

### 고객 구독에 삽입되는 CSV 제품

사용자의 소프트웨어를 최종 고객이 소유하는 구독에 배포할 수 있습니다. 템플릿을 사용하여 고객의 Azure 계정으로 고유한 배포를 수행할 수 있습니다.

이러한 배포는 고객의 계정 내에서 배포를 업데이트하고 관리할 수 있도록 RBAC를 사용합니다.

### Azure 마켓플레이스

Azure Marketplace 같은 마켓플레이스를 통해 제품을 광고하고 판매하기 위해 고객의 Azure 계정에서 실행되는 고유한 배포 유형을 제공하도록 템플릿을 개발할 수 있습니다. 고유한 배포는 일반적으로 티셔츠 크기(대, 중, 소), 제품/대상 그룹 유형(커뮤니티, 개발자, 엔터프라이즈) 또는 기능 유형(기본, 고가용성)으로 명시됩니다. 이런 유형을 통해 VM 유형이나 디스크 수와 같은 배포의 특성을 지정할 수 있는 경우도 있습니다.

## OSS 프로젝트

오픈 소스 프로젝트 내에서 리소스 관리자 템플릿을 사용하면 입증된 작업 방식을 사용하여 커뮤니티에서 신속하게 솔루션을 배포할 수 있습니다. 시간이 지난 후에 커뮤니티에서 수정할 수 있도록 GitHub 리포지터리에 템플릿을 저장할 수 있습니다. 사용자는 자신의 Azure 구독에 이 템플릿을 배포합니다.

다음 섹션에서는 솔루션을 설계하기 전에 고려해야 할 사항을 확인합니다.

## VM의 외부 및 내부 항목 확인

템플릿을 설계하는 경우 가상 컴퓨터(VM) 외부 및 내부 항목에 관한 요구 사항을 살펴보는 것이 도움이 됩니다.

- 외부는 VM 및 네트워크 토폴로지, 태그 지정, 인증/기밀 정보에 대한 참조, 역할 기반 액세스 제어 같은 배포의 기타 리소스를 의미합니다. 이러한 모든 리소스가 템플릿의 일부입니다.
- 내부는 설치된 소프트웨어 및 전체적으로 필요한 상태 구성을 의미합니다. 그 외에 VM 확장 또는 스크립트 같은 기타 메커니즘이 전체적으로 또는 부분적으로 사용됩니다. 이러한 메커니즘은 템플릿으로 식별하고 실행할 수 있지만 템플릿에 포함되어 있지 않습니다.

“박스 안”에서 수행하는 작업의 일반적인 예

- 서버 역할 및 기능을 설치 또는 제거
- 노드 또는 클러스터 수준에서 소프트웨어를 설치 및 구성
- 웹 서버에서 웹 사이트 배포
- 데이터베이스 스키마 배포
- 레지스트리 또는 다른 유형의 구성 설정 관리
- 파일 및 디렉터리 관리
- 프로세스 및 서비스 시작, 중지 및 관리
- 로컬 그룹 및 사용자 계정 관리
- 패키지(.msi, .exe, yum 등) 설치 및 관리
- 환경 변수 관리
- 네이티브 스크립트(Windows PowerShell, bash 등) 실행

### DSC(필요한 상태 구성)

배포 이외에 VM 내부 상태와 관련하여 배포에 대해 직접 정의하고 소스 제어에 체크 인해 놓은 구성이 상황에 따라 변경되지 않도록 하는 것이 좋습니다. 이러한 접근 방식은 개발자나 운영 담당자가 소스 제어 내에서 조사하거나 테스트하거나 기록하지 않은 환경을 임의 변경을 하지 않도록 합니다. 이 제어는 수동 변경 내용이 소스 컨트롤에 없고 표준 배포의 일부도 아니면서 자동화된 소프트웨어 배포에 나중에 영향을 미치게 되기 때문에 중요합니다.

내부 직원 외에 필요한 상태 구성은 보안적인 관점에서 중요합니다. 해커는 주기적으로 소프트웨어 시스템을 손상시키고 악용하려는 시도를 합니다. 성공한 경우에는 일반적으로 파일을 설치하고 그렇지 않으면 손상된 시스템의 상태를 변경합니다. 필요한 상태 구성을 사용하면 필요한 상태와 실제 상태 간의 델타를 확인하고 알려진 구성을 복원할 수 있습니다.

가장 인기있는 DSC 메커니즘에 대한 리소스 확장이 있습니다(PowerShell DSC, Chef, 및 Puppet). 이러한 각각의 확장은 VM의 초기 상태를 배포할 수 있고 필요한 상태가 유지되도록 하는 데 사용될 수 있습니다.

## 일반적인 템플릿 범위

경험을 통해 세 가지 주요 솔루션 템플릿을 확인하였습니다. 이 세 가지 범위, 즉 용량, 기능 및 종단간 솔루션이 다음 섹션에 설명되어 있습니다.

### 용량 범위

용량 범위는 규정 및 정책을 준수하도록 미리 구성된 표준 토폴로지로 리소스 세트를 제공합니다. 가장 일반적인 사례는 엔터프라이즈 IT 또는 SI 시나리오에서 표준 개발 환경을 배포하는 것입니다.

### 기능 범위

기능 범위는 특정 기술에 대한 토폴로지를 배포 및 구성하는 것에 초점을 맞춥니다. 일반적인 시나리오는 SQL Server, Cassandra, Hadoop 같은 기술을 포함합니다.

### 종단간 솔루션 범위

종단간 솔루션 범위는 단일 기능 이상을 목표로 하며 복수의 기능으로 구성된 종단간 솔루션을 제공하는 것에 중점을 둡니다.

솔루션 범위 템플릿의 범위는 솔루션 고유의 리소스, 논리 및 필요한 상태를 포함하는 하나 이상의 기능 범위 템플릿 집합으로 자체 명시됩니다. 솔루션 범위 템플릿의 예제는 종단간 데이터 파이프라인 솔루션 템플릿입니다. 템플릿은 솔루션별 토폴로지와 상태를 Kafka, Storm, Hadoop과 같은 여러 기능 범위 솔루션 템플릿과 혼합할 수 있습니다.

## 자유 형식 또는 알려진 구성 선택

처음에는 템플릿이 소비자에게 최대의 유연성을 제공해야 한다고 생각할 수 있지만 자유 형식 구성과 알려진 구성 중에 무엇을 선택할지에 대해서는 많은 고려 사항이 영향을 미칩니다. 이 섹션에서는 이 문서에서 공유한 접근 방식을 형성하는 기술적인 고려 사항과 주요 고객 요구 사항을 확인합니다.

### 자유 형식 구성

표면적으로는 자유 형식 구성이 이상적으로 보입니다. VM 유형을 선택할 수 있고 임의의 수의 노드 및 그 노드와 연결된 디스크를 제공하고 매개 변수가 템플릿에 제공하듯이 편리한 기능을 제공합니다. 그러나 이 접근 방식은 일부 시나리오에는 적합하지 않습니다.

[가상 컴퓨터의 크기](./virtual-machines/virtual-machines-windows-sizes.md)에서 다양한 VM 유형과 사용 가능한 크기 및 각각 연결할 수 있는 지속형 디스크의 수(2, 4, 8, 16, 또는 32)를 식별합니다. 각각의 연결된 디스크는 500 IOPS를 제공하며 이 디스크의 배수는 해당 IOPS의 승수로 풀링될 수 있습니다. 예를 들어 디스크 16개는 8,000 IOPS를 제공하도록 풀링될 수 있습니다. 풀링은 Microsoft Windows 저장소 공간 또는 Linux의 RAID(Redundant Array of Inexpensive Disks)를 사용하여 운영 체제에서 구성을 사용하여 수행됩니다.

자유 형식 구성에서는 다수의 VM 인스턴스를 선택할 수 있고, 인스턴스에 대해 다수의 다양한 VM 유형 및 크기를 선택할 수 있고, VM 유형을 기반으로 달라질 수 있는 디스크의 수와 VM 콘텐츠 구성을 위한 하나 이상의 스크립트를 선택할 수 있습니다.

모든 노드 유형에 대해 유연성이 제공될 수 있도록 배포에는 마스터 및 데이터 노드 같이 여러 가지 유형의 노드를 포함하는 것이 일반적입니다.

어떠한 중요도의 클러스터에 대한 배포를 시작하든 모든 항목의 배수로 작업을 시작합니다. 예를 들어, 마스터 노드 8개와 데이터 노드 200개를 포함하는 Hadoop 클러스터를 배포하는 경우 각 마스터 노드에 대해 연결된 디스크를 4개 풀링하고 데이터 노드 당 연결된 디스크를 16개 풀링하면 관리할 VM은 208개가 되고 디스크는 3,232개가 됩니다.

저장소 계정은 초당 20,000개의 식별된 트랜잭션을 초과하는 요청을 제한하므로 저장소 계정 분할에 주목하고 계산을 사용하여 토폴로지를 수용하기에 적합한 저장소 계정의 수를 판단하도록 해야 합니다. 자유 형식 접근 방식으로 지원되는 조합이 다수인 경우에는 적합한 분산을 판단하기 위하여 동적 계산이 필요합니다. Azure 리소스 관리자 템플릿 언어는 현재 수학 함수를 제공하지 않으므로 적절한 세부 사항이 고유하게 하드 코딩된 템플릿을 생성하는 코드로 계산을 수행해야 합니다.

엔터프라이즈 IT 및 SI 시나리오에서 누군가는 템플릿을 유지 관리해야 하고 한 곳 이상의 조직에 배포된 토폴로지에 대한 지원을 제공해야 합니다. 고객별로 구성과 템플릿이 다르기 때문에 발생하는 부가적인 오버헤드는 결코 바람직하지 않습니다.

이 템플릿을 사용하면 고객의 Azure 구독에 환경을 배포하면서도 고객 청구에 대해 환불 기능을 사용하여 기업 IT 팀과 CSV 양쪽 모두가 전과 같이 자체적인 구독에 환경을 배포할 수 있습니다. 이 시나리오의 목표는 구독 풀 전체적으로 복수 고객을 위한 수용량을 배포하고 구독이 불규칙하게 퍼지는 현상(스프롤)을 최소화하여 관리할 구독이 더 많도록 구독에 배포가 촘촘하게 채워진 상태를 유지하는 것입니다. 실제로 동적인 배포 크기에 대해 이런 유형의 밀도를 달성하려면 조직을 위한 신중한 계획과 스캐폴딩 작업을 위한 추가적인 개발이 필요합니다.

또한 API 호출을 통해 구독을 만들 수 없지만 포털을 통해 수동으로 이를 수행해야 합니다. 구독의 수가 증가하면 그로 인해 발생하는 구독 스프롤에 사용자의 개입이 필요합니다. 이 작업은 자동화가 불가능합니다. 배포의 크기에 변화가 큰 경우에는 배포의 가용성을 확실하게 하기 위해 구독의 수를 수동으로 미리 프로비전해야 할 수 있습니다.

이러한 모든 요소를 고려하면 진정한 자유 형식 구성은 언뜻 보기에 덜 매력적입니다.

### 알려진 구성 — 티셔츠 크기 접근 방식

경험에 따르면 절대적인 유연성과 수많은 변형을 제공하는 템플릿을 제공하기 보다는 알려진 구성(실제로 샌드박스, 대, 중, 소 같은 표준 티셔츠 크기)을 선택하도록 기능을 제공하는 것이 일반적인 패턴입니다. 티셔츠 크기의 다른 예에는 커뮤니티 버전이나 엔터프라이즈 버전 같은 제품이 있습니다. 그 외 경우에는 Map Reduce 또는 No SQL 같은 특정 워크로드에 대한 기술 구성이 있습니다.

많은 엔터프라이즈 IT 조직, OSS 공급업체 및 SI에서 현재 이러한 방식으로 온-프레미스, 가상화된 환경(엔터프라이즈) 또는 SaaS(Software-as-a-Service) 제품(CSV 및 OSV)으로 자사의 제품을 제공합니다.

이러한 접근 방식은 고객을 위해 미리 구성된 다양한 크기의 좋은, 알려진 구성을 제공합니다. 알려진 구성이 없는 경우, 최종 고객은 자체적으로 클러스터 크기, 플랫폼 리소스 제약 조건의 요소를 결정해야 하고 그에 따라 파생되는 저장소 계정 및 기타 리소스(클러스터 크기 및 리소스 제약 조언에 따른)에 대한 분할을 식별하기 위해 수학을 해야 합니다. 알려진 구성을 통해 고객은 적절한 티셔츠 크기 즉, 주어진 배포를 쉽게 선택할 수 있습니다. 고객을 위한 환경을 개선하는 것 외에도, 소수의 알려진 구성은 지원하기가 쉽고 높은 수준의 밀도를 제공하는데 도움이 됩니다.

티셔츠 크기에 중점을 두는 알려진 구성 접근 방식은 하나의 크기 내에 다양한 수의 노드를 둘 수도 있습니다. 예를 들어 작은 티셔츠 크기는 3개에서 10개 사이의 노드가 될 수 있습니다. 티셔츠 크기는 최대 10개의 노드를 수용하도록 설계되며 식별되는 최대 크기 내에서 고객이 자유 형식의 선택을 할 수 있도록 제공됩니다.

워크로드 유형에 기반하는 티셔츠 크기는 배포될 수 있는 노드의 수 측면에서 본질적으로 자유 형식에 더 가까울 수 있지만 노드의 소프트웨어에 대한 구성 및 워크로드 고유의 노드 크기를 갖습니다.

커뮤니티 또는 엔터프라이즈 같이 제품을 기반으로 하는 티셔츠 크기는 고유의 리소스 유형 및 배포될 수 있는 최대 노드 수를 가질 수 있고 일반적으로 여러 가지 제품에 대해 라이선스 고려 사항이나 기능의 가용성이 제한됩니다.

JSON 기반 템플릿을 사용하여 고객에게 고유한 변형을 제공할 수도 있습니다. 이상값을 처리하는 경우 개발, 지원 및 비용을 위해 적절한 계획과 고려 사항을 통합할 수 있습니다.

고객 템플릿 소비 시나리오, 문서의 시작 부분에서 확인한 요구 사항, 수많은 템플릿을 생성한 실제 경험을 바탕으로 템플릿 분해 패턴을 확인하였습니다.

## 용량 및 기능 범위 솔루션 템플릿

분해는 재사용, 확장성, 테스트 및 도구를 지원하는 템플릿 개발에 대한 모듈식 접근 방식을 제공합니다. 이 섹션은 분해 접근 방식이 용량 및 기능 범위를 포함하는 템플릿에 적용되는 방법에 대한 세부 사항을 제공합니다.

이 접근 방식에서 기본 템플릿은 템플릿 소비자로부터 매개 변수 값을 받은 후 아래 표시된 것과 같이 몇 가지 유형의 템플릿과 스크립트에 연결합니다. 매개 변수, 정적 변수 및 생성된 변수는 연결된 템플릿의 내부 및 외부 값을 제공하는데 사용됩니다.

![템플릿 매개 변수](./media/best-practices-resource-manager-design-templates/template-parameters.png)

**매개 변수는 기본 템플릿에 전달된 후 연결된 템플릿으로 전달됩니다.**

다음 섹션은 단일 템플릿이 분해되는 스크립트와 템플릿의 유형을 중점적으로 설명하고 템플릿 사이에서 상태 정보를 전달하는 접근 방식을 살펴봅니다. 이미지에 포함된 각 템플릿과 스크립트 유형은 예제와 함께 설명됩니다. 상황별 예제를 보려면 이 문서의 뒷부분에서 “요약: 샘플 구현"을 참조하세요.

### 템플릿 메타데이터

템플릿 메타데이터(metadata.json 파일)는 사람과 소프트웨어 시스템이 읽을 수 있는 JSON으로 템플릿을 설명한 키/값 쌍을 포함합니다.

![템플릿 메타데이터](./media/best-practices-resource-manager-design-templates/template-metadata.png)

**템플릿 메타데이터는 metadata.json 파일에 설명됩니다.**

소프트웨어 에이전트는 metadata.json 파일을 검색하고 정보와 링크를 웹 페이지 또는 디렉터리의 템플릿에 게시할 수 있습니다. 요소는 *itemDisplayName*, *description*, *summary*, *githubUsername* 및 *dateUpdated*를 포함합니다.

예제 파일 전체가 아래에 표시됩니다.

    {
        "itemDisplayName": "PostgreSQL 9.3 on Ubuntu VMs",
        "description": "This template creates a PostgreSQL streaming-replication between a master and one or more slave servers each with 2 striped data disks. The database servers are deployed into a private-only subnet with one publicly accessible jumpbox VM in a DMZ subnet with public IP.",
        "summary": "PostgreSQL stream-replication with multiple slave servers and a publicly accessible jumpbox VM",
        "githubUsername": "arsenvlad",
        "dateUpdated": "2015-04-24"
    }

### 기본 템플릿

기본 템플릿은 사용자로부터 매개 변수를 받아서 복잡한 개체 변수를 채우는 데 해당 정보를 사용하고 연결된 템플릿을 실행합니다.

![기본 템플릿](./media/best-practices-resource-manager-design-templates/main-template.png)

**기본 템플릿은 사용자로부터 매개 변수를 받습니다.**

제공되는 하나의 매개 변수는 대, 중, 소 같이 규격화된 값 때문에 티셔츠 크기 매개 변수로도 알려져 있는 구성 유형입니다. 실제로 이 매개 변수를 여러 가지 방식으로 사용할 수 있습니다. 자세한 내용은 이 문서의 뒷부분에서 “알려진 구성 리소스 템플릿"을 참조하십시오.

일부 리소스는 사용자 매개 변수로 지정된 알려진 구성과 관계없이 배포됩니다. 이런 리소스는 단일 공유 리소스 템플릿을 사용하여 프로비전되고 다른 템플릿에서 공유되어 공유 리소스 템플릿이 먼저 실행됩니다.

일부 리소스는 지정된 알려진 구성에 관계없이 선택적으로 배포됩니다.

### 공유 리소스 템플릿

이 템플릿은 알려진 모든 구성에 공통적인 리소스를 제공합니다. 가상 네트워크, 가용성 집합 및 배포되는 알려진 구성 템플릿과 관계없이 필요한 기타 리소스를 포함합니다.

![템플릿 리소스](./media/best-practices-resource-manager-design-templates/template-resources.png)

**공유 리소스 템플릿**

가상 네트워크 이름 같은 리소스 이름은 기본 템플릿을 기반으로 합니다. 조직의 요구에 따라서 해당 템플릿에 포함된 변수로 이름을 지정하거나 사용자로부터 매개 변수로 이름을 받을 수 있습니다.

### 선택적 리소스 템플릿

선택적 리소스 템플릿은 매개 변수 또는 변수의 값에 기반한 프로그래밍 방식으로 배포된 리소스를 포함합니다.

![선택적 리소스](./media/best-practices-resource-manager-design-templates/optional-resources.png)

**선택적 리소스 템플릿**

예를 들어 선택적 리소스 템플릿을 사용하여 공용 인터넷에서 배포된 환경에 간접적인 액세스를 가능하게 하는 jumpbox를 구성할 수 있습니다. 매개 변수 또는 변수를 사용하여 jumpbox 사용 여부를 확인하고 *concat* 함수를 사용하여 템플릿에 대한 대상 이름(예: *jumpbox\_enabled.json*)을 빌드할 수 있습니다. 템플릿 연결은 jumpbox를 설치하기 위해 생성된 변수를 사용합니다.

여러 위치에서 선택적 리소스 템플릿을 링크할 수 있습니다.

-	모든 배포에 해당되는 경우 공유 리소스 템플릿에서 매개 변수 기반 링크를 만듭니다.
-	알려진 구성을 선택하는 경우에 해당되면(예를 들어 대형 배포에 설치하는 경우) 알려진 구성 템플릿으로부터 매개 변수 기반 또는 변수 기반 링크를 만듭니다.

지정된 리소스가 선택적인 리소스가 될지 여부는 템플릿 소비자가 아닌 템플릿 공급자에 기반합니다. 예를 들어 특정한 제품 요구 사항 또는 제품 추가 기능(CSV에 공통적인)을 충족해야 하거나 정책을 적용해야 하는 경우(SI 및 엔터프라이즈 IT 그룹에 일반적인)가 있습니다. 이런 경우 리소스 배포 여부를 확인하는 변수를 사용할 수 있습니다.

### 알려진 구성 리소스 템플릿

기본 템플릿에서 템플릿 소비자가 배포에 필요한 알려진 구성을 지정하도록 매개 변수를 노출할 수 있습니다. 알려진 구성은 샌드박스, 대, 중, 소와 같은 고정된 구성 크기 집합으로 티셔츠 크기 접근 방식을 자주 사용합니다.

![알려진 구성 리소스](./media/best-practices-resource-manager-design-templates/known-config.png)

**알려진 구성 리소스 템플릿**

티셔츠 크기 접근 방식이 일반적으로 사용되지만 매개 변수는 알려진 모든 구성 집합을 나타낼 수 있습니다. 예를 들어 개발, 테스트, 제품 같은 엔터프라이즈 응용 프로그램을 위한 환경 집합을 지정할 수 있습니다. 또는 클라우드 서비스에 대해 여러 가지 배율 단위, 제품 버전, 또는 커뮤니티, 개발자, 또는 엔터프라이즈 같은 제품 구성을 나타내도록 사용할 수 있습니다.

공유 리소스 템플릿에서와 같이 변수는 아래 항목 중 하나로부터 알려진 구성 템플릿으로 전달됩니다.

-	최종 사용자—기본 템플릿에 전송되는 매개 변수
-	조직—내부 요구 사항 또는 정책을 나타내는 기본 템플릿에 포함된 매개 변수

### 멤버 리소스 템플릿

알려진 구성 내에는 하나 이상의 멤버 노드 유형이 포함됩니다. 예를 들어 Hadoop에 마스터 노드와 데이터 노드를 포함합니다. MongoDB를 설치하는 경우 데이터 노드와 중재자를 포함합니다. DataStax를 배포하는 경우 데이터 노드는 물론 OpsCenter가 설치된 VM을 포함합니다.

![멤버 리소스](./media/best-practices-resource-manager-design-templates/member-resources.png)

**멤버 리소스 템플릿**

각 노드 유형은 크기가 다른 VM, 다수의 연결된 디스크, 노드를 설치하고 설정할 스크립트, VM에 대한 포트 구성, 다수의 인스턴스 및 기타 세부 사항을 포함할 수 있습니다. 따라서 각 노드 유형은 인프라 배포 및 구성에 대한 세부 사항은 물론 VM 내에서 소프트웨어를 배포 및 구성하기 위한 실행 스크립트를 포함하는 고유의 멤버 리소스 템플릿을 포함합니다.

VM의 경우 일반적으로 두 가지 유형의 스크립트(광범위한 재사용이 가능한 스크립트와 사용자 지정 스크립트)가 사용됩니다.

### 광범위한 재사용이 가능한 스크립트

광범위한 재사용이 가능한 스크립트는 여러 가지 유형의 템플릿에서 사용될 수 있습니다. 광범위한 재사용이 가능한 스크립트의 좋은 예 중 하나는 디스크를 풀링하고 더 많은 IOPS를 확보하기 위해 Linux에서 RAID를 설정하는 것입니다. VM에 설치되는 소프트웨어와 관계없이 이 스크립트는 공통 시나리오에 대해 검증된 작업 방식의 재사용을 제공합니다.

![재사용이 가능한 스크립트](./media/best-practices-resource-manager-design-templates/reusable-scripts.png)

**멤버 리소스 템플릿은 광범위한 재사용이 가능한 스크립트를 호출할 수 있습니다.**

### 사용자 지정 스크립트

템플릿은 일반적으로 VM 내에 소프트웨어를 설치 및 구성하는 스크립트를 하나 이상 호출합니다. 하나 이상의 멤버 유형의 여러 인스턴스가 배포되는 큰 토폴로지에서 일반적인 패턴이 보입니다. 설치 스크립트가 병렬 실행이 가능한 모든 VM에 대해 시작되고 모든 VM(또는 지정된 멤버 유형의 모든 VM)이 배포된 후에 호출되는 설정 스크립트가 그 뒤를 따릅니다.

![사용자 지정 스크립트](./media/best-practices-resource-manager-design-templates/custom-scripts.png)

**멤버 리소스 템플릿은 VM 구성 같은 특정 목적을 위한 스크립트를 호출할 수 있습니다.**

## 기능 범위 솔루션 템플릿 예 - Redis

구현의 작동 원리를 보기 위해 표준 티셔츠 크기로 Redis의 배포 및 구성에 도움이 되는 템플릿을 빌드하는 실례를 살펴보겠습니다.

배포에 대해 공유 리소스 집합(가상 네트워크, 저장소 계정, 가용성 집합)과 선택적 리소스(jumpbox)가 있습니다. 티셔츠 크기(대, 중, 소)로 표시되지만 각각 단일 노드 유형을 포함하는 여러 개의 알려진 구성이 있습니다. 또한 특정 목적에 따른 스크립트(설치, 구성)가 두 개 있습니다.

### 템플릿 파일 만들기

이름이 azuredeploy.json인 기본 템플릿을 만듭니다.

이름이 shared-resources.json인 공유 리소스 템플릿을 만듭니다.

이름이 jumpbox\_enabled.json인 jumpbox를 배포할 수 있도록 선택적 리소스 템플릿을 만듭니다.

Redis는 단일 노드 유형만을 사용하므로 이름이 node-resources.json인 단일 멤버 리소스 템플릿을 만듭니다.

Redis를 사용하여 각각의 개별 노드를 설치한 후 클러스터를 설정하려고 합니다. 설치 및 설정을 수용할 스크립트가 있습니다(redis-cluster-install.sh 및 redis-cluster-setup.sh).

### 템플릿 연결

기본 템플릿은 템플릿 연결을 사용하여 공유 리소스 템플릿으로 연결하고 이를 통해 가상 네트워크가 수립됩니다.

jumpbox 배포 여부를 템플릿 소비자가 지정할 수 있도록 기본 템플릿 내에 논리가 추가됩니다. *EnableJumpbox* 매개 변수에 *enabled* 값을 설정하면 고객이 jumpbox 배포를 원한다는 것을 나타냅니다. 이 값이 제공되면 템플릿은 jumpbox 기능에 대한 기본 템플릿 이름에 *\_enabled*를 접미사로 연결합니다.

기본 템플릿은 티셔츠 크기에 대한 기본 템플릿 이름에 대한 접미사로 *large* 매개 변수 값을 적용한 후 *technology\_on\_os\_large.json*에 대한 템플릿 링크에 해당 값을 사용합니다.

토폴로지는 이러한 예시와 유사합니다.

![Redis 템플릿](./media/best-practices-resource-manager-design-templates/redis-template.png)

**Redis 템플릿에 대한 템플릿 구조**

### 구성 상태

클러스터의 노드에는 상태를 구성하는 두 가지 단계가 있으며 양쪽 모두 특정 목적에 따른 스크립트로 표시됩니다. “redis-cluster-install.sh”는 Redis를 설치하고 “redis-cluster-setup.sh”는 클러스터를 설정합니다.

### 갖가지 크기의 배포 지원

변수 내에서 티셔츠 크기 템플릿은 지정된 크기(*large*)로 배포할 각 유형의 노드 수를 지정합니다. 그런 다음 리소스 루프를 사용하여 VM 인스턴스를 해당되는 수만큼 배포하고 *copyIndex()*로부터 숫자형 시퀀스 번호를 노드 이름에 추가하여 리소스에 고유한 이름을 제공합니다. 티셔츠 이름 템플릿에 정의된 바와 같이 핫 존과 웜 존 모두에 대해 이 단계를 수행합니다.

## 분해 및 종단간 솔루션 범위 템플릿

종단간 솔루션 범위를 포함하는 솔루션 템플릿은 종단간 솔루션을 제공하는데 중점을 둡니다. 일반적으로 이 접근 방식은 추가적인 리소스, 논리 및 상태를 포함하는 복수의 기능 범위 템플릿의 결합입니다.

아래 이미지의 강조 표시와 같이 기능 범위 템플릿에 사용되는 동일한 모델이 종단간 솔루션 범위를 포함하는 템플릿에 대해 확장됩니다.

공유 리소스 템플릿 및 선택적 리소스 템플릿은 용량 및 기능 범위 템플릿 접근 방식과 동일한 기능을 제공하지만 종단간 솔루션에 대해 범위가 지정됩니다.

종단간 솔루션 범위 템플릿 역시 티셔츠 크기를 포함할 수 있듯이, 알려진 구성 리소스 템플릿은 솔루션에 지정된 알려진 구성에 무엇이 필요한지를 반영합니다.

알려진 구성 리소스 템플릿은 종단간 솔루션과 관련된 하나 이상의 기능 범위 솔루션 템플릿은 물론 종단간 솔루션에 필요한 멤버 리소스 템플릿에 연결됩니다.

솔루션의 티셔츠 크기는 개별적인 기능 범위 템플릿의 그것과 다를 수 있으며 알려진 구성 리소스 템플릿에 포함된 변수는 적절한 티셔츠 크기를 배포하기 위하여 다운스트림 기능 범위 솔루션 템플릿에 적절한 값을 제공하기 위해 사용됩니다.

![종단간](./media/best-practices-resource-manager-design-templates/end-to-end.png)

**용량 또는 기능 범위 솔루션 템플릿에 사용되는 모델은 종단간 솔루션 템플릿 범위에 대해 즉시 확장될 수 있습니다.**

## 마켓플레이스에 대한 템플릿 준비

앞의 접근 방식은 엔터프라이즈, SI, CSV가 직접 템플릿을 배포하거나 고객이 스스로 배포하도록 만드는 시나리오를 쉽게 수용합니다.

여기서 더 필요한 시나리오는 마켓플레이스를 통해 템플릿을 배포하는 것입니다. 이러한 분해 접근 방식은 마켓플레이스는 물론 일부 경미한 변경이 있는 경우에 유용합니다.

이전에 설명했지만 템플릿은 마켓플레이스에서 판매를 위한 고유 배포 유형을 제공하는데 사용될 수 있습니다. 고유 배포 유형은 티셔츠 크기(대, 중, 소), 제품/대상 그룹 유형(커뮤니티, 개발자, 엔터프라이즈) 또는 기능 유형(기본, 고가용성)이 될 수 있습니다.

아래 표시된 것처럼 기존의 종단간 솔루션 또는 기능 범위 템플릿은 마켓플레이스에서 갖가지 알려진 구성을 나열하기 위해 즉시 활용될 수 있습니다.

기본 템플릿에 대한 매개 변수는 우선 이름이 tshirtSize인 인바운드 매개 변수를 제거하기 위해 수정됩니다.

고유의 배포 유형이 알려진 구성 리소스 템플릿에 매핑되는 동안 공유 리소스 템플릿에 있는 공통 리소스 및 구성이 필요하며 선택적 리소스 템플릿에 포함된 구성이 잠재적으로 필요할 수 있습니다.

마켓플레이스에 템플릿을 게시하려면 템플릿에 포함된 변수에 대해 이전에 사용이 가능했던 tshirtSize의 인바운드 매개 변수를 대체하는 기본 템플릿의 사본을 설정합니다.

![마켓플레이스](./media/best-practices-resource-manager-design-templates/marketplace.png)

**마켓플레이스에 대해 솔루션 범위 템플릿 조정**

## 다음 단계

- Azure 리소스 관리자에서 보안을 처리하는 방법에 대한 권장 사항을 보려면 [Azure 리소스 관리자에 대한 보안 고려 사항](best-practices-resource-manager-security.md)을 참조하세요.
- 템플릿 내부 및 외부로 상태를 공유하는 방법을 알아보려면 [Azure 리소스 관리자 템플릿에서 상태 공유](best-practices-resource-manager-state.md)를 참조하세요.

<!---HONumber=AcomDC_0914_2016-->