<properties
	pageTitle="Azure Insights: Azure Insights 자동 크기 조정에 대한 모범 사례 | Microsoft Azure"
	description="Azure Insights에서 자동 크기 조정을 효과적으로 사용하기 위한 원칙을 알아봅니다."
	authors="kamathashwin"
	manager=""
	editor=""
	services="monitoring-and-diagnostics"
	documentationCenter="monitoring-and-diagnostics"/>

<tags
	ms.service="monitoring-and-diagnostics"
	ms.workload="na"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="07/15/2016"
	ms.author="ashwink"/>

# Azure Insights 자동 크기 조정에 대한 모범 사례

이 문서의 다음 섹션에서는 Azure Insights의 자동 크기 조정에 대한 모범 사례를 이해하도록 도와줍니다. 이 정보를 검토한 후에는 Azure 인프라에서 자동 크기 조정을 효과적으로 사용할 수 있게 됩니다.

## 자동 크기 조정 개념

- 하나의 리소스에는 *하나의* 자동 크기 조정 설정만 있을 수 있습니다.
- 자동 크기 조정 설정에는 하나 이상의 프로필이 있을 수 있으며, 각 프로필에는 하나 이상의 자동 크기 조정 규칙이 있을 수 있습니다.
- 자동 크기 조정 설정은 인스턴스 크기를 수평적으로 조정합니다. 즉, 인스턴스를 늘려 *규모를 확장*하고 인스턴스 수를 줄여 *규모를 감축*합니다. 자동 크기 조정 설정에는 최대, 최소 및 기본 인스턴스 값이 있습니다.
- 자동 크기 조정 작업에서는 항상 규모 확장 또는 규모 감축에 대해 구성된 임계값에 도달했는지 확인하여 크기를 조정할 연관된 메트릭을 읽습니다. [Azure Insights 자동 크기 조정 공통 메트릭](insights-autoscale-common-metrics.md)에서 자동 크기 조정을 통해 크기를 조정할 수 있는 메트릭 목록을 볼 수 있습니다.
- 모든 임계값은 인스턴스 수준에서 계산됩니다. 예를 들어 "인스턴스 수가 2일 때 평균 CPU가 80%를 초과하면 1인스턴스만큼 규모 확장"은 모든 인스턴스에서 평균 CPU가 80%보다 높은 경우에 규모를 확장함을 의미합니다.
- 항상 메일을 통해 오류 알림이 제공됩니다. 특히, 대상 리소스의 소유자, 참가자 및 읽기 권한자에게 메일이 제공됩니다. 또한 자동 크기 조정이 오류에서 복구하여 정상적으로 작동하기 시작하면 항상 *복구* 메일이 제공됩니다.
- 성공적인 크기 조정 작업 알림을 메일과 webhook를 통해 받도록 옵트인할 수 있습니다.

## 자동 크기 조정 모범 사례

자동 크기 조정을 사용할 때 다음 모범 사례를 따르세요.

### 최대값과 최소값이 다르고 둘 사이의 간격이 적당한지 확인
최대값=2, 최소값=2 및 현재 인스턴스 수가 2인 설정이 있는 경우에는 발생할 수 있는 크기 조정 동작이 없습니다. 권장 설정은 최대 인스턴스 수와 최소 인스턴스 수 간에 적당한 간격을 유지하는 것입니다. 자동 크기 조정은 항상 이러한 한도(포함) 사이에서 크기를 조정합니다. 그러나 인스턴스 수를 최대값보다 높은 값으로 수동으로 조정(업데이트)하기로 결정한 경우를 가정해 보겠습니다. 다음에 자동 크기 조정 작업이 실행될 때 현재 인스턴스 수가 최대값보다 큰지 확인합니다. 최대값보다 큰 경우 규칙에 설정된 임계값에 상관없이 최대값으로 규모를 감축합니다. 마찬가지로 현재 인스턴스 수를 최소값보다 작은 값으로 수동으로 조정한 경우 다음에 자동 크기 조정 작업이 실행될 때 최소 인스턴스 수로 규모가 확장됩니다.

### 항상 증가 및 감소를 수행하는 규모 확장 및 규모 감축 규칙의 조합 사용

이 조합의 한 부분만 사용하는 경우에는 자동 크기 조정에서 최대값 또는 최소값에 도달할 때까지 해당 부분만 규모를 확장하거나 감축합니다.

### 자동 크기 조정을 관리할 때 Azure 포털 및 Azure 클래식 포털 간에 전환 금지
클라우드 서비스 및 앱 서비스(웹앱)의 경우 Azure 포털(portal.azure.com)을 사용하여 자동 크기 조정 설정을 만들고 관리합니다. 가상 컴퓨터 크기 조정 집합의 경우 PoSH, CLI 또는 REST API를 사용하여 자동 크기 조정 설정을 만들고 관리합니다. 자동 크기 조정 구성을 관리할 때 Azure 클래식 포털(manage.windowsazure.com)과 Azure 포털(portal.azure.com) 간에 전환 금지 Azure 클래식 포털과 해당 기본 백 엔드에는 제한이 있습니다. 그래픽 사용자 인터페이스를 사용하여 자동 크기 조정을 관리하려면 Azure 포털로 이동합니다. Azure 리소스 탐색기를 통해 자동 크기 조정 PowerShell, CLI 또는 REST API를 사용할 수 있습니다.

### 진단 메트릭에 적절한 통계 선택
진단 메트릭의 경우 크기를 조정할 메트릭으로 *평균*, *최소*, *최대* 및 *합계* 중에서 선택할 수 있습니다. 가장 일반적인 통계는 *평균*입니다.

### 모든 메트릭 유형에 대해 신중하게 임계값 선택
현실적인 상황을 기반으로 서로 다른 규모 확장 및 규모 감축 임계값을 신중하게 선택하는 것이 좋습니다.

아래 예와 같이 확장 및 감축 조건에 동일하거나 매우 유사한 임계값을 사용하는 자동 크기 조정 설정은 *권장되지 않습니다*.

- 스레드 수가 600 이하인 경우 인스턴스 수 1개 증가
- 스레드 수가 600 이상인 경우 인스턴스 수 1개 감소


혼동스러운 동작을 초래할 수 있는 예를 살펴보겠습니다. 인스턴스 2개로 시작한 다음 인스턴스당 평균 스레드 수가 625로 증가했다고 가정해 보겠습니다. 자동 크기 조정에서 세 번째 인스턴스를 추가하여 규모를 확장합니다. 다음으로, 인스턴스 전체의 평균 스레드 수가 575로 떨어졌다고 가정해 보겠습니다. 축소하기 전에 자동 크기 조정에서 감축된 경우의 최종 상태를 예측하려고 시도합니다. 예를 들어 575x3(현재 인스턴스 수) = 1,725/2(축소된 경우의 최종 인스턴스 수) = 862.5스레드입니다. 이는 평균 스레드 수가 동일하게 유지되거나 약간만 감소한 경우 자동 크기 조정에서 규모가 감축된 후 즉시 다시 확장해야 함을 의미합니다. 그러나 규모가 다시 확장된 경우 전체 프로세스가 반복되므로 무한 루프가 발생합니다. 이 *느슨한* 상황을 방지하기 위해 자동 크기 조정에서는 규모를 축소하지 않습니다. 대신 건너뛰고 다음에 서비스의 작업이 실행될 때 조건을 다시 평가합니다. 이는 평균 스레드 수가 575일 때 자동 크기 조정이 작동하지 않는 것처럼 보이기 때문에 많은 사용자에게 혼동을 줄 수 있었습니다.

규모 감축 중의 이러한 평가 동작은 느슨한 상황을 방지하기 위한 것입니다. 규모 확장 및 감축에 대해 동일한 임계값을 선택할 때 이 동작을 염두에 두어야 합니다.

규모 확장 및 감축 임계값 사이에 적당한 간격을 선택하는 것이 좋습니다. 예를 들어, 다음과 같은 더 나은 규칙 조합을 고려합니다.

- CPU%가 80 이상인 경우 인스턴스 수 1개 증가
- CPU%가 60 이하인 경우 인스턴스 수 1개 감소

이 예제의 작동 방식을 검토해 보겠습니다. 두 개의 인스턴스로 시작한다고 가정합니다. 인스턴스의 평균 CPU%가 80이 되면 자동 크기 조정에서 세 번째 인스턴스를 추가하여 규모를 확장합니다. 이제 시간이 지남에 따라 CPU%가 60으로 감소했다고 가정합니다. 자동 크기 조정의 규모 감축 규칙에서 규모가 감축된 경우의 최종 상태를 평가합니다. 예를 들어 60x3(현재 인스턴스 수) = 180/2(축소된 경우의 최종 인스턴스 수) = 90입니다. 따라서 자동 크기 조정에서는 즉시 다시 확장해야 하므로 규모를 감축하지 않습니다. 대신, 규모 축소를 건너뜁니다. 이번에는 다음에 확인할 때 CPU가 계속 50으로 감소하여 다시 평가한 것으로 가정합니다. 50 x 3 인스턴스 = 150/2 인스턴스 = 75이며, 이는 규모 확장 임계값 80보다 낮으므로 인스턴스 2개로 성공적으로 감축합니다.

### 특정 메트릭의 임계값 조정에 대한 고려 사항
 저장소 또는 서비스 버스 큐 길이 메트릭과 같은 특정 메트릭의 경우 임계값은 현재 인스턴스 수당 사용 가능한 평균 메시지 수입니다. 이 메트릭에 대한 임계값을 신중하게 선택해야 합니다.

동작을 보다 잘 이해할 수 있도록 예를 들어 살펴보겠습니다.

- 저장소 큐 메시지 수가 50개 이상인 경우 인스턴스 수 1개 증가
- 저장소 큐 메시지 수가 10개 이하인 경우 인스턴스 수 1개 감소

두 개의 인스턴스로 시작한다고 가정합니다. 다음으로, 메시지가 계속 들어오고 있으며 저장소 큐를 검토했을 때 총 개수가 50개라고 가정합니다. 자동 크기 조정에서 규모 확장 동작을 시작해야 한다고 생각할 수 있습니다. 그러나 인스턴스당 메시지 수는 여전히 50/2 = 25개입니다. 따라서 규모 확장이 발생하지 않습니다. 첫 번째 규모 확장이 발생하려면 저장소 큐의 총 메시지 수가 100개여야 합니다. 이번에는 총 메시지 수가 100개에 도달했다고 가정합니다. 규모 확장 동작으로 인해 세 번째 인스턴스가 추가됩니다. 큐의 총 메시지 수가 150개에 도달할 때까지 다음 규모 확장 동작이 발생하지 않습니다. 규모 감축 동작을 살펴보겠습니다. 인스턴스 수가 3개라고 가정합니다. 첫 번째 규모 감축 동작은 큐의 총 메시지 수가 30개에 도달한 경우에 발생합니다. 이 경우 인스턴스당 메시지 수를 규모 감축 임계값인 30/3 = 10개로 조정합니다.

### 자동 크기 조정 설정에 여러 프로필이 구성된 경우 크기 조정에 대한 고려 사항

자동 크기 조정 설정에서 일정이나 시간에 종속되지 않고 항상 적용되는 기본 프로필을 선택하거나, 날짜 및 시간 범위가 있는 고정된 기간의 프로필 또는 되풀이 프로필을 선택할 수 있습니다.

자동 크기 조정 서비스는 이를 처리할 때 항상 다음 순서대로 확인합니다.

1. 고정된 날짜 프로필
2. 되풀이 프로필
3. 기본("항상") 프로필

프로필 조건이 충족된 경우 자동 크기 조정은 그 아래의 다음 프로필 조건을 확인하지 않습니다. 자동 크기 조정에서는 한 번에 하나의 프로필만 처리합니다. 따라서 하위 계층 프로필의 처리 조건을 포함하려는 경우 이러한 규칙을 현재 프로필에도 포함해야 합니다.

예제를 사용하여 이를 검토해 보겠습니다.

아래 그림에는 최소 인스턴스 = 2이고 최대 인스턴스 = 10인 기본 프로필의 자동 크기 조정 설정을 보여 줍니다. 이 예제에서는 큐의 메시지 수가 10보다 큰 경우 규모를 확장하고, 큐의 메시지 수가 3보다 작은 경우 규모를 감축하도록 규칙이 구성되어 있습니다. 따라서 지금은 리소스의 크기를 2에서 10 사이로 조정할 수 있습니다.

또한 월요일에 설정된 되풀이 프로필이 있습니다. 이는 최소 인스턴스 = 2, 최대 인스턴스 = 12에 대해 설정되어 있습니다. 따라서 월요일에는 자동 크기 조정에서 처음이 이 조건을 확인하여 인스턴스 수가 2인 경우 새 최소값 3으로 크기를 조정합니다. 자동 크기 조정에서 일치하는 이 프로필 조건을 계속 찾는 한 이 프로필에 대해 구성된 CPU 기반 규모 확장/감축 규칙만 처리합니다. 이 경우 큐 길이를 확인하지 않습니다. 그러나 큐 길이 조건도 확인하려는 경우 기본 프로필의 이러한 규칙을 월요일 프로필에도 포함해야 합니다.

마찬가지로, 자동 크기 조정이 다시 기본 프로필로 전환하는 경우에는 먼저 최소값 및 최대값 조건이 충족되는지 확인합니다. 이때 인스턴스 수가 12인 경우 기본 프로필에 허용되는 최대값인 10으로 규모를 감축합니다.

![자동 크기 조정 설정](./media/insights-autoscale-best-practices/insights-autoscale-best-practices.png)

### 하나의 프로필에 여러 규칙이 구성된 경우 크기 조정에 대한 고려 사항
하나의 프로필에 여러 규칙을 설정해야 할 수 있는 경우가 있습니다. 여러 규칙이 설정된 경우 다음과 같은 자동 크기 조정 규칙 집합이 서비스에서 사용됩니다.

*규모 확장*의 경우 임의의 규칙이 충족되면 자동 크기 조정이 실행됩니다. *규모 감축*의 경우 모든 규칙이 충족되어야 자동 크기 조정이 실행됩니다.

이를 설명하기 위해 다음 4가지 자동 크기 조정 규칙이 있다고 가정합니다.

- CPU가 30% 미만인 경우 1만큼 규모 감축
- 메모리가 50% 미만인 경우 1만큼 규모 감축
- CPU가 75% 초과인 경우 1만큼 규모 확장
- 메모리가 75%를 초과하는 경우 1만큼 규모 확장

이 경우 다음 상황이 발생합니다.

- CPU가 76%이고 메모리가 50%인 경우 규모가 확장됩니다.
- CPU가 50%이고 메모리가 76%인 경우 규모가 확장됩니다.

반면, CPU가 25%이고 메모리가 51%인 경우 자동 크기 조정에서 규모를 감축하지 **않습니다**. 규모를 감축하려면 CPU가 29%이고 메모리가 49%여야 합니다.

### 항상 안전한 기본 인스턴스 수 선택
기본 인스턴스 수는 메트릭을 사용할 수 없을 때 자동 크기 조정에서 서비스 크기를 조정하는 인스턴스 수이므로 매우 중요합니다. 따라서 워크로드에 안전한 기본 인스턴스 수를 선택해야 합니다.

### 자동 크기 조정 알림 구성
자동 크기 조정에서는 다음 조건 중 하나가 발생한 경우 리소스 관리자 및 참가자에게 메일로 알려 줍니다.
- 자동 크기 조정 서비스에서 작업에 실패한 경우
- 자동 크기 조정 서비스에서 크기 조정 결정을 내리는 데 메트릭을 사용할 수 없는 경우
- 크기 조정 결정을 내리는 데 메트릭을 다시 사용할 수 있게 된(복구) 경우 위 조건 외에 성공적인 크기 조정 동작에 대한 알림을 받도록 메일 또는 webhook 알림을 구성할 수 있습니다.

<!---HONumber=AcomDC_0914_2016-->