<properties
   pageTitle="Microsoft 클라우드 서비스 및 네트워크 보안 | Microsoft Azure"
   description="보안 네트워크 환경을 만드는 데 유용한 Azure의 몇 가지 핵심 기능 알아보기"
   services="virtual-network"
   documentationCenter="na"
   authors="tracsman"
   manager="rossort"
   editor=""/>

<tags
   ms.service="virtual-network"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="03/14/2016"
   ms.author="jonor;sivae"/>

# Microsoft 클라우드 서비스 및 네트워크 보안

Microsoft 클라우드 서비스는 하이퍼 스케일 서비스와 인프라, 엔터프라이즈급 기능 및 여러 하이브리드 연결 옵션을 제공합니다. 고객은 인터넷이나, 사설 네트워크 연결을 제공하는 Azure Express 경로를 통해 이러한 서비스에 액세스할 수 있습니다. 고객은 Microsoft Azure Platform을 통해 인프라를 클라우드로 자연스럽게 확장하고 다중 계층 아키텍처를 빌드할 수 있습니다. 또한 타사 보안 서비스 및 가상 어플라이언스를 통해 향상된 기능을 구현할 수 있습니다. 이 백서에서는 Express 경로를 통해 액세스하는 Microsoft 클라우드 서비스 사용할 때 고객이 고려해야 하는 보안 및 아키텍처 문제에 대해 개괄적으로 설명합니다 또한 Azure 가상 네트워크에서 더 안전한 서비스를 만드는 과정을 다룹니다.

## 빠른 시작
다음 논리 차트를 통해 Azure 플랫폼에서 사용 가능한 여러 보안 기술의 특정 예를 확인할 수 있습니다. 빠른 참조를 원하는 경우 사용자의 사례에 가장 적합한 예제를 찾고, 전체 설명을 원하는 경우 이 백서를 계속 읽어 보세요. ![보안 옵션 순서도][0]

[예제 1: NSG(네트워크 보안 그룹)로 응용 프로그램을 보호하는 경계 네트워크(DMZ, 완충 영역 및 스크린된 서브넷이라고도 함) 빌드](#example-1-build-a-simple-dmz-with-nsgs)</br> [예제 2: 방화벽 및 NSG로 응용 프로그램을 보호하는 경계 네트워크 빌드](#example-2-build-a-dmz-to-protect-applications-with-a-firewall-and-nsgs)</br> [예제 3: 방화벽, UDR(사용자 정의 경로) 및 NSG로 응용 프로그램을 보호하는 경계 네트워크 빌드](#example-3-build-a-dmz-to-protect-networks-with-a-firewall-udr-and-nsg)</br> [예제 4: 사이트 간 가상 어플라이언스 VPN(가상 사설망)에 하이브리드 연결 추가](#example-4-adding-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn)</br> [예제 5: 사이트 간 Azure 게이트웨이 VPN을 통한 하이브리드 연결 추가](#example-5-adding-a-hybrid-connection-with-a-site-to-site-azure-gateway-vpn)</br> [예제 6: Express 경로를 통한 하이브리드 연결 추가](#example-6-adding-a-hybrid-connection-with-expressroute)</br> 가상 네트워크 간 연결 추가, 고가용성 및 서비스 체인에 대한 예제는 차후 몇 달 동안 이 문서에 추가될 것입니다.

## Microsoft 규정 준수 및 인프라 보호
Microsoft는 기업 고객이 요구하는 규정 준수 이니셔티브를 지원하기 위해 선도적으로 대처하고 있습니다. 다음은 Azure 규정 준수 인증의 몇 가지 예입니다: ![Azure 규정 준수 배지][1].

자세한 내용은 [Microsoft 보안 센터](https://azure.microsoft.com/support/trust-center/compliance/)에서 규정 준수 정보를 참조하세요.

Microsoft는 하이퍼 스케일 글로벌 서비스를 실행하는 데 필요한 클라우드 인프라를 보호하기 위한 포괄적인 접근 방식을 취하고 있습니다. Microsoft 클라우드 인프라에는 하드웨어, 소프트웨어, 네트워크, 관리 및 운영 인력과 물리적 데이터 센터가 포함됩니다.

![Azure 보안 기능][2]

이 접근 방식을 통해 Microsoft 클라우드에서의 고객 서비스 배포를 위한 보다 안전한 토대를 제공합니다. 다음 단계는 고객이 서비스 보호를 위한 보안 아키텍처를 설계하고 만드는 것입니다.

## 기존 보안 아키텍처 및 경계 네트워크
Microsoft에서는 클라우드 인프라 보호를 위해 상당한 투자를 하고 있으나 고객 역시 자신의 클라우드 서비스와 리소스 그룹을 보호해야 합니다. 다단계 접근 방식의 보안이 최상의 방어를 제공합니다. 경계 네트워크 보안 영역은 신뢰할 수 없는 네트워크로부터 내부 네트워크 리소스를 보호합니다. 경계 네트워크는 보호되는 엔터프라이즈 IT 인프라와 인터넷 사이에 위치한 네트워크의 일부 또는 경계를 말합니다.

일반적인 엔터프라이즈 네트워크에서 핵심 인프라는 여러 계층의 보안 장치를 통해 경계에서 강력히 보호됩니다. 각 계층의 경계는 장치와 정책 적용 지점으로 구성됩니다. 장치에는 방화벽, DDoS(분산 서비스 거부) 방지, IDS/IPS(침입 감지 또는 방지 시스템), VPN(가상 사설망) 장비 등이 해당합니다. 정책 적용은 방화벽 정책, ACL(액세스 제어 목록) 또는 특정 라우팅 등의 형태가 될 수 있습니다. 네트워크에서 인터넷으로부터 들어오는 트래픽을 직접 수신하는 방어의 최일선에서는 이러한 메커니즘을 조합하여 공격과 유해한 트래픽을 차단하면서 합당한 요청은 네트워크로 전달되도록 허용합니다. 경계 네트워크에서는 이 트래픽이 리소스로 직접 라우팅됩니다. 그러면 해당 리소스가 네트워크의 더 안쪽에 있는 리소스와 "통신"하고, 유효성 확인을 위해 다음 경계로 전환합니다. 일반적으로 가장 바깥쪽 계층을 경계 네트워크라고 합니다. 이 부분의 네트워크가 보통 양쪽에서 몇 가지 보호 형태를 통해 인터넷에 노출되기 때문입니다. 다음 그림은 두 보안 경계가 있는 회사 네트워크의 단일 서브넷 경계 네트워크 예를 나타냅니다.

![회사 네트워크의 경계 네트워크][3]

경계 네트워크를 구현하는 데는 웹 팜의 앞에 있는 단일 부하 분산 장치에서, 각 경계에서 트래픽을 차단하고 회사 네트워크의 내부 계층을 보호하기 위해 다양한 메커니즘을 사용하는 여러 서브넷 경계 네트워크에 이르기까지 다양한 아키텍처를 사용합니다. 경계 네트워크 빌드 방법은 조직의 특정한 요구와 전반적인 위험 허용 수준에 따라 달라집니다.

고객이 워크로드를 공용 클라우드로 이동할 때는 규정 준수 및 보안 요구 사항에 부합하기 위해 Azure에서 경계 네트워크 아키텍처에 유사한 기능을 지원하는 것이 중요합니다. 이 문서는 다음 질문을 망라하여 경계 네트워크에 초점을 맞추면서도, 네트워크 보안의 다양한 측면에 대한 광범위한 논의를 유도할 수 있는 방향으로 고객이 Azure에서 보안 네트워크 환경을 빌드하는 방법에 대한 지침을 제공합니다.

- Azure에서 경계 네트워크를 빌드하는 방법
- 경계 네트워크 빌드에 사용할 수 있는 몇 가지 Azure 기능
- 백 엔드 워크로드 보호 방법
- Azure에서 워크로드에 대한 인터넷 통신을 제어하는 방법
- Azure의 배포에서 온-프레미스 네트워크를 보호하는 방법
- 타사 어플라이언스나 서비스에 기본 Azure 보안 기능을 사용하는 방법

다음 다이어그램에서는 기본 Azure 플랫폼과 고객 정의 기능을 통해 Azure가 고객에게 제공하는 다양한 보안 계층을 설명합니다.

![Azure 보안 아키텍처][4]

인터넷부터 안쪽으로는 Azure에 대한 대규모 공격을 방지하기 위한 Azure DDoS 방지가 있습니다. 다은 계층은 클라우드 서비스를 통과하여 가상 네트워크로 갈 수 있는 트래픽을 결정하는 데 사용되는 고객이 정의한 공용 끝점입니다. 기본 Azure 가상 네트워크 격리를 통해 모든 타 네트워크를 격리하고 트래픽이 사용자가 구성한 경로 및 방법을 통해서만 흐르게 할 수 있습니다. 이러한 경로 및 방법은 다음 계층으로, NSG, UDR 및 네트워크 가상 어플라이언스를 사용하여 보안 경계를 만들어 보호되는 네트워크에서의 응용 프로그램 배포를 보호할 수 있습니다.

다음 섹션에서는 Azure 가상 네트워크에 대한 개요를 제공합니다. 이러한 가상 네트워크는 고객이 만들며 배포된 워크로드가 연결되는 대상입니다. 가상 네트워크는 Azure에서의 고객 배포를 보호하기 위해 경계 네트워크를 빌드할 때 필요한 모든 네트워크 보안 기능의 기반이 됩니다.

## Azure 가상 네트워크 개요
인터넷 트래픽이 Azure 가상 네트워크에 도달하기 전에 Azure 플랫폼 안에는 두 보안 계층이 있습니다.

1.	**DDoS 방지**: DDoS 방지는 대규모 인터넷 기반 공격으로부터 Azure 플랫폼 자체를 보호하는 Azure의 물리적 네트워크 계층입니다. 이러한 공격에서는 여러 "봇" 노드를 사용하여 인터넷 서비스 과부하를 시도합니다. Azure에는 모든 인바운드 인터넷 연결에 강력한 DDoS 방지 메시가 있습니다. 이 DDoS 방지 계층은 사용자가 구성 가능한 속성이 없으며 고객이 액세스할 수 없습니다. 이를 통해 플랫폼 Azure를 대규모 공격으로부터는 보호하지만 개별 고객 응용 프로그램을 직접 보호하지는 않습니다. 국지화된 공격에 대처하기 위해 고객이 복원을 위한 또 다른 계층을 구성할 수 있습니다. 예를 들어, 고객 A가 공용 끝점에서 대규모 공격을 당한다면 Azure는 해당 서비스에 대한 연결을 차단합니다. 고객 A는 해당 공격과 연루되지 않은 다른 가상 네트워크나 서비스 끝점으로 장애 조치하여 서비스를 복원할 수 있습니다. 여기서 중요한 점은 고객 A는 이 끝점에서 영향을 받을 수 있지만 이 끝점 밖의 다른 서비스는 영향을 받지 않는다는 것입니다. 또한 이 공격이 다른 고객 및 서비스에는 영향이 없습니다.
2.	**서비스 끝점**: 끝점은 클라우드 서비스나 리소스 그룹이 공용 인터넷 IP 주소와 포트를 노출할 수 있게 하며, NAT(Network Address Translation)를 사용하여 트래픽을 Azure 가상 네트워크상의 내부 주소와 포트로 라우팅합니다. 이것이 외부 트래픽을 가상 네트워크 내부로 전달하는 기본 경로입니다. 서비스 끝점은 사용자가 구성하여 어떤 트래픽을 안으로 들이며, 가상 네트워크의 어느 부분에서 어떻게 전환하느냐를 결정할 수 있습니다.

트래픽이 가상 네트워크에 도달하면 작동하는 많은 기능이 있습니다. Azure 가상 네트워크는 고객이 워크로드를 연결하고 기본 네트워크 수준의 보안을 적용하는 토대입니다. 다음 기능과 특성을 갖는 Azure의 고객용 사설 네트워크(가상 네트워크 계층)입니다.
 
- **트래픽 격리**: 가상 네트워크는 Azure 플랫폼에서 트래픽 격리 경계입니다. 두 가상 네트워크를 같은 고객이 만들었다 하더라도, 한 가상 네트워크의 VM(가상 컴퓨터)은 다른 가상 네트워크의 VM과 직접 통신할 수 없습니다. 이것은 고객 VM과 통신이 가상 네트워크 안에서 비공개 상태를 유지하는 데 있어 중요한 속성입니다.
- **다중 계층 토폴로지**: 가상 네트워크에서는 고객이 서브넷을 할당하고 워크로드의 서로 다른 요소나 "계층"에 별도의 주소 공간을 지정하여 다중 계층 토폴로지를 정의할 수 있습니다. 이러한 논리적 그룹화 및 토폴로지를 통해 고객은 워크로드 유형에 따른 다양한 액세스 정책을 정의하고 계층 간의 트래픽 흐름을 제어할 수 있습니다.
- **크로스 프레미스 연결**: 고객은 가상 네트워크와 다중 온-프레미스 사이트 간 또는 Azure의 다른 가상 네트워크 간에 크로스 프레미스 연결을 설정할 수 있습니다. 이를 위해 고객은 Azure VPN 게이트웨이 또는 타사 네트워크 가상 어플라이언스를 사용할 수 있습니다. Azure는 표준 IPsec/IKE 프로토콜 및 Express 경로 개인 연결을 사용한 사이트 간(S2S) VPN을 지원합니다.
- **NSG**를 통해 고객은 원하는 네트워크 인터페이스, 개별 VM 또는 가상 서브넷 상세 수준에서 규칙을 만들 수 있습니다. 고객은 크로스 프레미스 연결을 통한 고객 네트워크 상의 시스템이나 직접 인터넷 통신을 통해서 고객 네트워크 시스템으로부터 가상 네트워크 내 워크로드 간 통신을 허용하거나 거부하여 액세스를 제어할 수 있습니다.
- **UDR** 및 **IP 전달**을 통해 고객은 가상 네트워크 내 여러 계층 간 통신 경로를 정의할 수 있습니다. 고객은 보안 경계 정책 적용, 감사 및 검사를 위해 방화벽, IDS/IPS 및 기타 가상 어플라이언스를 배포하고 이러한 보안 어플라이언스를 통해 네트워크 트래픽을 라우팅할 수 있습니다.
- Azure 마켓플레이스의 **네트워크 가상 어플라이언스**: 방화벽, 부하 분산 장치, IDS/IPS 등의 보안 어플라이언스는 Azure 마켓플레이스와 VM 이미지 갤러리에서 사용할 수 있습니다. 고객은 이러한 어플라이언스를 가상 네트워크, 특히 보안 경계(경계 네트워크 서브넷 포함)에 배포하여 다중 계층 보안 네트워크 환경을 완성할 수 있습니다.

이러한 특성과 기능을 활용하여 Azure에서 경계 네트워크 아키텍처를 구조화하는 한 예는 다음과 같습니다.

![Azure 가상 네트워크의 경계 네트워크][5]

## 경계 네트워크 특성 및 요구 사항
경계 네트워크는 인터넷으로부터의 통신을 직접 인터페이스하는 네트워크의 프런트 엔드가 되도록 설계되었습니다. 들어오는 패킷은 백 엔드 서버에 도달하기 전에 방화벽, IDS, IPS 등의 보안 어플라이언스를 통과해야 합니다. 정책 적용, 검사 및 감사를 위해 워크로드의 인터넷 바인딩 패킷도 네트워크에 도착하기 전에 경계 네트워크 내 보안 어플라이언스를 통과할 수 있습니다. 또한 경계 네트워크는 고객 가상 네트워크 간 크로스-프레미스 VPN 게이트웨이 및 온-프레미스 네트워크를 호스트할 수 있습니다.

### 경계 네트워크 특성
위 그림에서 적절한 경계 네트워크의 몇 가지 특성은 다음과 같습니다.

- 인터넷 연결:
    - 경계 네트워크 서브넷 자체가 인터넷에 연결하며 인터넷과 직접 통신
    - 공용 IP, VIP 및/또는 서비스 끝점이 프런트 엔드 네트워크 및 장치에 인터넷 트래픽 전달
    - 인터넷으로부터의 인바운드 트래픽이 프런트 엔드 네트워크의 타 리소스에 앞서 보안 장치를 통과함
    - 아웃바운드 보안을 사용할 경우, 트래픽이 인터넷에 전달되기 전 마지막 단계로 보안 장치를 통과함
- 보호되는 네트워크:
    - 인터넷에서 핵심 인프라로 가는 직접 경로 없음
    - 핵심 인프라에 대한 채널은 NSG, 방화벽 또는 VPN 장치 등의 보안 장치를 통과해야 함
    - 다른 장치는 인터넷과 핵심 인프라를 연결해서는 안 됨
    - 경계 네트워크의 인터넷 연결 및 보호되는 네트워크 연결 경계 모두에 있는 보안 장치(예: 위 그림에 표시된 두 개의 방화벽 아이콘)는 실질적으로는 각 경계에 대해 서로 다른 규칙 또는 인터페이스를 적용한 단일 가상 어플라이언스(즉, 경계 네트워크의 두 경계에 대한 로드를 처리하는 논리적으로 구분된 하나의 장치)일 수 있음
- 다른 일반적인 사례 및 제약 조건
    - 워크로드는 업무상 중요 정보를 저장할 수 없음
    - 경계 네트워크 구성 및 배포에 대한 액세스 및 업데이트는 권한이 있는 관리자로 제한됨

### 경계 네트워크 요구 사항
이러한 특성을 사용하려면 성공적인 경계 네트워크 구현을 위한 가상 네트워크 요구 사항에 대한 지침을 따르세요.

- **서브넷 아키텍처**: 동일한 가상 네트워크의 타 서브넷과는 별도로 전체 서브넷이 경계 네트워크를 전담하는 가상 네트워크를 지정합니다. 이렇게 하면 경계 네트워크와 다른 내부 또는 사설 서브넷 계층 간 트래픽이 사용자 정의 경로가 있는 서브넷 경계의 방화벽이나 IDS/IPS 가상 어플라이언스를 통해 흐르게 됩니다.
- **NSG**: 경계 네트워크 서브넷 자체는 인터넷과의 통신을 허용하도록 열려 있어야 하나, 고객이 NSG를 통과할 수 있다는 뜻은 아닙니다. 일반적인 보안 방법에 따라 인터넷에 노출된 네트워크 영역을 최소화합니다. 열려 있는 특정 응용 프로그램 프로토콜 및 포트 또는 배포에 대한 액세스가 허용된 원격 주소 범위를 잠급니다. 그러나 항상 그렇게 할 수 있는 것은 아닙니다. 예를 들어, 고객이 Azure에 외부 웹 사이트를 갖고 있다면 경계 네트워크는 공용 IP 주소로부터 들어오는 웹 요청을 허용해야 하지만 웹 응용 프로그램 포트 TCP:80 및 TCP:443만 열어야 합니다.
- **라우팅 테이블**: 경계 네트워크 서브넷 자체는 인터넷과 직접 통신할 수 있어야 하지만, 방화벽이나 보안 어플라이언스를 통과하지 않고 백 엔드나 온-프레미스 네트워크에서 오고 가는 직접 통신을 허용해서는 안 됩니다.
- **보안 어플라이언스 구성**: 경계 네트워크와 나머지 보호되는 네트워크 간의 패킷 라우팅 및 검사를 위해 방화벽, IDS, IPS 등의 보안 어플라이언스가 멀티 홈으로 구성될 수 있습니다. 경계 네트워크와 백 엔드 서브넷에 대해 별도의 NIC가 있을 수 있습니다. 경계 네트워크의 NIC는 해당 NSG와 경계 네트워크 라우팅 테이블에 따라 인터넷과 직접 통신합니다. 백 엔드 서브넷에 연결하는 NIC는 더 제한적인 해당 백 엔드 서브넷의 NSG와 라우팅 테이블을 갖게 됩니다.
- **보안 어플라이언스 기능**: 일반적으로 경계 네트워크에 배포된 보안 어플라이언스는 다음과 같은 기능을 수행합니다.
    - 방화벽: 들어오는 요청에 대한 방화벽 규칙 또는 액세스 제어 정책 적용
    - 위협 탐지 및 방지: 인터넷의 악의적인 공격을 탐지 및 완화
    - 감사 및 로깅: 감사 및 분석을 위한 상세 로그 유지 관리
    - 역방향 프록시: 프런트 엔드 장치(일반적으로 방화벽)의 대상 주소를 실제 백 엔드 서버 주소로 매핑 및 전환하여 해당 백 엔드 서버로 들어오는 요청을 리디렉션
    - 프록시 전달: NAT를 제공하며, 가상 네트워크 안에서 시작되어 인터넷으로 향하는 통신에 대한 감사 수행
    - 라우터: 가상 네트워크 안에서 수신 트래픽과 크로스 서브넷 트래픽 전달
    - VPN 장치: 고객 온-프레미스 네트워크와 Azure 가상 네트워크 간 크로스 프레미스 VPN 연결을 위한 크로스 프레미스 VPN 게이트웨이 역할 수행
    - VPN 서버: Azure 가상 네트워크에 연결하는 VPN 클라이언트를 수락

>[AZURE.TIP] 경계 네트워크 보안 장치 액세스 권한을 부여 받은 개인 그룹과 응용 프로그램 개발/배포/운영 관리자 권한이 있는 개인 그룹을 별도로 유지하세요. 이 그룹을 별개로 유지하면 의무를 분리하고, 한 개인이 응용 프로그램 보안과 네트워크 보안 제어를 모두 통과하는 것을 방지할 수 있습니다.

### 네트워크 경계 빌드 중의 질문에 대한 대답
이 섹션에서 "네트워크"를 말할 때는 특별히 언급하지 않은 한 구독 관리자가 만든 사설 Azure 가상 네트워크를 의미하며, Azure 내의 기본 실제 네트워크를 의미하는 것이 아닙니다.

또한 Azure 가상 네트워크는 기존 온-프레미스 네트워크를 확장하는 데도 종종 사용됩니다. 사이트 간 또는 Express 경로 하이브리드 네트워킹 솔루션을 경계 네트워크 아키텍처에 통합할 수도 있습니다. 이 점은 네트워크 보안 경계를 구성할 때 고려해야 하는 중요한 요소입니다.

경계 네트워크 및 다중 보안 경계와의 네트워크를 빌드할 때는 다음 3가지 중요한 질문을 고려해야 합니다.

#### 1) 필요한 경계 수는?
첫 번째 의사 결정 포인트는 주어진 시나리오에서 필요한 보안 경계 수를 결정하는 것입니다.

- 단일 경계: 가상 네트워크와 인터넷 사이의 프런트 엔드 경계 네트워크에 하나
- 두 경계: 경계 네트워크 네트워크의 인터넷 쪽에 하나, 경계 네트워크 서브넷과 Azure 가상 네트워크의 백 엔드 서브넷 사이에 또 하나
- 세 경계 - 경계 네트워크의 인터넷 쪽, 경계 네트워크와 백 엔드 서브넷 사이, 백 엔드 서브넷과 온-프레미스 네트워크 사이에 각각 하나
- N개 경계 - 가변적. 보안 요구 사항에 따라, 주어진 네트워크에 적용 가능한 보안 경계의 수에는 끝이 없음

필요한 경계의 수와 유형은 회사의 위험 감수 수준과 구현할 특정 시나리오에 따라 달라집니다. 이것은 종종 위험 및 규정 준수 팀, 네트워크 및 플랫폼 팀, 응용 프로그램 개발 팀 등, 조직 내 여러 그룹이 함께 결정하는 사안입니다. 이러한 의사 결정에서는 각 구현마다 적합한 보안 태도를 갖출 수 있게 보안, 관련 데이터 및 사용할 기술에 대해 알고 있는 사람들의 의견이 반영되어야 합니다.

>[AZURE.TIP] 주어진 상황에서 보안 요구 사항을 만족하는 최소한의 경계를 사용합니다. 경계가 많아지면 작업과 문제 해결이 어려워질 수 있으며 시간이 흐를수록 여러 경계 관리에 소요되는 운영상의 과부하가 발생할 수 있습니다. 그러나 경계가 불충분하면 위험이 커집니다. 균형점을 찾는 것이 중요합니다.

![3개의 보안 경계가 있는 하이브리드 네트워크][6]

위의 그림에서는 경계 네트워크 인터넷 간 경계, Azure 프런트 엔드와 백 엔드 사설 서브넷 간 경계, Azure 백 엔드 서브넷과 온-프레미스 기업 네트워크 간 경계 등, 3개의 보안 경계 네트워크를 간략히 보여 줍니다.

#### 2) 경계의 위치는?
경계 수를 결정한 뒤에는 경계의 구현 위치를 결정해야 합니다. 일반적으로
- 1) 인터넷 기반 중개 서비스 사용(예: 클라우드 기반 웹 응용 프로그램 방화벽, 이 문서에서 논의하지 않음)
- 2) Azure 기본 기능 및/또는 네트워크 가상 어플라이언스 사용
- 3) 온-프레미스 네트워크의 물리적 장치 사용의 세 가지 선택이 있습니다.

순 Azure 네트워크에서는 기본 Azure 기능(예: Azure 부하 분산 장치)나, Azure의 다양한 파트너가 제공하는 네트워크 가상 어플라이언스(예: Check Point 방화벽)를 선택할 수 있습니다.

Azure와 온-프레미스 네트워크 간에 경계가 필요할 경우 보안 장치는 연결의 어느 쪽에나(또는 양쪽 모두에) 있을 수 있습니다. 따라서 이에 대한 결정은 보안 장치를 배치하는 쪽에서 수행합니다.

위 그림에서 인터넷-경계 네트워크 및 프런트 엔드-백 엔드 경계는 모두 Azure 안에 있으며, 기본 Azure 기능이거나 네트워크 가상 어플라이언스여야 합니다. Azure(백 엔드 서브넷)와 회사 네트워크 간 경계에 있는 보안 장치는 Azure 측이나 온-프레미스에 있을 수 있으며 양측의 장치를 조합할 수도 있습니다. 두 옵션에는 모두 심각히 고려해야 하는 중요한 장단점이 있을 수 있습니다.

온-프레미스 네트워크 측의 기존 물리적 보안 장치를 사용하는 경우를 예로 들어 보겠습니다. 장점은 새 장치 없이 재구성만 하면 된다는 점입니다. 그러나 단점은 모든 트래픽이 보안 장치에서 확인할 수 있게 Azure에서 온-프레미스 네트워크로 되돌아가야 한다는 점입니다. 따라서 보안 정책 적용을 위해 온-프레미스 네트워크로 강제로 되돌아간다면 Azure 간 트래픽이 크게 지연되어 응용 프로그램 성능과 사용자 환경에 영향을 미칠 수 있습니다.

#### 3) 경계 구현 방법은?
각 보안 경계에 대한 기능 요구 사항은 서로 다를 수 있습니다(예: 경계 네트워크의 인터넷 측에서는 IDS와 방화벽 규칙이 필요하나 경계 네트워크와 백 엔드 서브넷 사이에는 ACL만 필요). 사용할 장치를 결정하는 것은 시나리오와 보안 요구 사항에 달려 있습니다. 아래 섹션의 예제 1, 2 및 3에서는 사용 가능한 몇 가지 옵션에 대해 논의합니다. Azure 기본 네트워크 기능과 Azure에서 사용 가능한 파트너 제공 장치를 검토하면 사실상 모든 시나리오에 부합하는 다양한 옵션을 갖게 됩니다.

구현 의사 결정의 또 다른 핵심 포인트는 온-프레미스 네트워크를 Azure와 연결하는 방법입니다. 즉, Azure 가상 게이트웨이 또는 네트워크 가상 어플라이언스를 사용하는 것입니다. 이러한 옵션은 아래 섹션(예제 4, 5, 6)에 자세히 설명되어 있습니다.

또한 Azure 내부의 가상 네트워크 간 트래픽이 필요할 수 있습니다. 이러한 시나리오는 다음에 추가될 예정입니다.

위의 질문을 고려한 후에는 앞의 [빠른 시작](#fast-start) 섹션을 통해 주어진 시나리오에 가장 적합한 예를 파악할 수 있습니다.

## 예제: Azure 가상 네트워크와의 보안 경계 빌드
### 예제 1: NSG로 응용 프로그램을 보호하는 경계 네트워크 빌드
[빠른 시작으로 돌아가기](#fast-start) | [이 예제의 상세 빌드 지침][Example1]

![NSG가 있는 인바운드 경계 네트워크][7]

#### 환경 설명
이 예제에는 다음을 포함하는 구독이 있습니다.

- 두 클라우드 서비스: "FrontEnd001" 및 "BackEnd001"
- "FrontEnd" 및 "BackEnd"의 두 서브넷을 포함하는 가상 네트워크 "CorpNetwork"
- 서브넷 모두에 적용되는 네트워크 보안 그룹
- 응용 프로그램 웹 서버("IIS01")를 나타내는 Windows 서버
- 응용 프로그램 백 엔드 서버("AppVM01", "AppVM02")를 나타내는 두 Windows 서버
- DNS 서버("DNS01")를 나타내는 Windows Server

스크립트 및 Azure Resource Manager 템플릿은 [상세 빌드 지침][Example1]을 참조하세요.

#### NSG 설명
이 예제에서는 NSG 그룹을 빌드한 후 6개의 규칙을 로드합니다.

>[AZURE.TIP] 일반적으로 특정 "허용" 규칙을 먼저 만든 후 보다 일반적인 "거부" 규칙을 만들어야 합니다. 주어진 우선 순위에 따라 먼저 평가할 규칙이 결정됩니다. 특정 규칙에 적용할 트래픽이 발견되면 규칙을 더 이상 평가하지 않습니다. NSG 규칙은 인바운드 또는 아웃바운드 방향으로 적용할 수 있습니다(서브넷 관점에서).

선언적으로 인바운드 트래픽에 대해 다음 규칙이 빌드됩니다.

1.	내부 DNS 트래픽(포트 53) 허용됨
2.	인터넷에서 모든 가상 컴퓨터로 RDP 트래픽(포트 3389) 허용됨
3.	인터넷에서 웹 서버(IIS01)로 HTTP 트래픽(포트 80) 허용됨
4.	IIS01에서 AppVM1로 모든 트래픽(모든 포트) 허용됨
5.	인터넷에서 전체 가상 네트워크(두 서브넷)으로 모든 트래픽(모든 포트) 거부됨
6.	프런트 엔드 서브넷에서 백 엔드 서브넷으로 모든 트래픽(모든 포트) 거부됨

각 서브넷에 바인딩된 이러한 규칙에서는 HTTP 요청이 인터넷에서 웹 서버로 들어오는 경우 규칙 3(허용) 및 5(거부)가 모두 적용되지만 규칙 3이 우선 순위가 높기 때문에 규칙 3만 적용되고 규칙 5는 진행되지 않습니다. 따라서 웹 서버에 대해 HTTP 요청이 허용됩니다. 동일한 트래픽이 DNS01 서버에 도달하려고 시도하는 경우 규칙 5(거부)는 가장 먼저 적용되며 트래픽을 서버에 전달할 수 없습니다. 규칙 6(거부)은 프런트 엔드 서브넷이 백 엔드 서브넷과 통신을 차단(규칙 1 및 4에서 허용된 트래픽 제외)하여 공격자가 프런트 엔드에서 웹 응용 프로그램을 손상시키는 경우 공격자의 "보호된" 백 엔드 네트워크(AppVM01 서버에서 노출되는 리소스만)에 대한 액세스가 제한되므로 백 엔드 네트워크를 보호합니다.

인터넷으로 트래픽을 허용하는 기본 아웃바운드 규칙이 있습니다. 이 예에서는 아웃바운드 트래픽을 허용하고 아웃바운드 규칙을 수정하지 않습니다. 양방향에서 트래픽을 잠그려면 사용자 정의 라우팅이 필요합니다("예제 3" 참조).

#### 결론
이 방법은 백 엔드 서브넷을 인바운드 트래픽과 격리하는 비교적 간단하고 직접적인 방법입니다. 자세한 내용은 [상세 빌드 지침][Example1]을 참조하세요. 이러한 지침에는 다음이 포함됩니다.

- PowerShell 스크립트를 통해 이 경계 네트워크를 빌드하는 방법
- Azure Resource Manager 템플릿을 사용하여 이 경계 네트워크를 빌드하는 방법
- 각 NSG 명령에 대한 상세 설명
- 각 계층에서의 트래픽 허용 또는 거부 방법을 나타내는 상세 트래픽 흐름 시나리오


 ### 예제 2: 방화벽 및 NSG로 응용 프로그램을 보호하는 DMZ 빌드 [빠른 시작으로 돌아가기](#fast-start) | [이 예제의 상세 빌드 지침][Example2]

![NVA와 NSG가 있는 인바운드 경계 네트워크][8]

#### 환경 설명
이 예제에는 다음을 포함하는 구독이 있습니다.

- 두 클라우드 서비스: "FrontEnd001" 및 "BackEnd001"
- "FrontEnd" 및 "BackEnd"의 두 서브넷을 포함하는 가상 네트워크 "CorpNetwork"
- 서브넷 모두에 적용되는 네트워크 보안 그룹
- 네트워크 가상 어플라이언스(이 예제의 경우 프런트 엔드 서브넷에 연결된 방화벽)
- 응용 프로그램 웹 서버("IIS01")를 나타내는 Windows 서버
- 응용 프로그램 백 엔드 서버("AppVM01", "AppVM02")를 나타내는 두 Windows 서버
- DNS 서버("DNS01")를 나타내는 Windows Server

스크립트 및 Azure Resource Manager 템플릿은 [상세 빌드 지침][Example2]을 참조하세요.

#### NSG 설명
이 예제에서는 NSG 그룹을 빌드한 후 6개의 규칙을 로드합니다.

>[AZURE.TIP] 일반적으로 특정 "허용" 규칙을 먼저 만든 후 보다 일반적인 "거부" 규칙을 만들어야 합니다. 주어진 우선 순위에 따라 먼저 평가할 규칙이 결정됩니다. 특정 규칙에 적용할 트래픽이 발견되면 규칙을 더 이상 평가하지 않습니다. NSG 규칙은 인바운드 또는 아웃바운드 방향으로 적용할 수 있습니다(서브넷 관점에서).

선언적으로 인바운드 트래픽에 대해 다음 규칙이 빌드됩니다.

1.	내부 DNS 트래픽(포트 53) 허용됨
2.	인터넷에서 모든 가상 컴퓨터로 RDP 트래픽(포트 3389) 허용됨
3.	네트워크 가상 어플라이언스(방화벽)에 대한 모든 인터넷 트래픽(모든 포트) 허용됨
4.	IIS01에서 AppVM1로 모든 트래픽(모든 포트) 허용됨
5.	인터넷에서 전체 가상 네트워크(두 서브넷)으로 모든 트래픽(모든 포트) 거부됨
6.	프런트 엔드 서브넷에서 백 엔드 서브넷으로 모든 트래픽(모든 포트) 거부됨

각 서브넷에 바인딩된 이러한 규칙에서는 HTTP 요청이 인터넷에서 방화벽으로 들어오는 경우 규칙 3(허용) 및 5(거부)가 모두 적용되지만 규칙 3이 우선 순위가 높기 때문에 규칙 3만 적용되고 규칙 5는 진행되지 않습니다. 따라서 방화벽에 대해 HTTP 요청이 허용됩니다. 동일한 트래픽이 IIS01 서버에 도달하려고 시도하는 경우 규칙 5(거부)가 적용되어 트래픽이 서버에 전달되는 것이 허용되지 않습니다. 규칙 6(거부)은 프런트 엔드 서브넷이 백 엔드 서브넷과 통신을 차단(규칙 1 및 4에서 허용된 트래픽 제외)하여 공격자가 프런트 엔드에서 웹 응용 프로그램을 손상시키는 경우 공격자의 "보호된" 백 엔드 네트워크(AppVM01 서버에서 노출되는 리소스만)에 대한 액세스가 제한되므로 백 엔드 네트워크를 보호합니다.

인터넷으로 트래픽을 허용하는 기본 아웃바운드 규칙이 있습니다. 이 예에서는 아웃바운드 트래픽을 허용하고 아웃바운드 규칙을 수정하지 않습니다. 양방향에서 트래픽을 잠그려면 사용자 정의 라우팅이 필요합니다("예제 3" 참조).

#### 방화벽 규칙 설명
방화벽에서 전달 규칙을 만들어야 합니다. 이 예에서는 인터넷 트래픽 인바운드를 방화벽으로 라우팅한 후 웹 서버로 라우팅하므로 하나의 전달 NAT(Network Address Translation) 규칙만 필요합니다.

전달 규칙은 HTTP(포트 80 또는 HTTPS인 경우 443)에 도달하려고 시도하는 방화벽을 호출하는 모든 인바운드 주소를 허용합니다. 이는 방화벽의 로컬 인터페이스에서 전송되고 IP 주소가 10.0.1.5인 웹 서버로 리디렉션됩니다.

#### 결론
이 방법은 방화벽으로 응용 프로그램을 보호하고 백 엔드 서브넷을 인바운드 트래픽과 격리하는 비교적 직접적인 방법입니다. 자세한 내용은 [상세 빌드 지침][Example2]을 참조하세요. 이러한 지침에는 다음이 포함됩니다.

- PowerShell 스크립트를 통해 이 경계 네트워크를 빌드하는 방법
- Azure Resource Manager 템플릿을 사용하여 이 예제를 빌드하는 방법
- 각 NSG 명령 및 방화벽 규칙에 대한 상세 설명
- 각 계층에서의 트래픽 허용 또는 거부 방법을 나타내는 상세 트래픽 흐름 시나리오

### 예제 3: 방화벽, UDR 및 NSG로 응용 프로그램을 보호하는 경계 네트워크 빌드
[빠른 시작으로 돌아가기](#fast-start) | [이 예제의 상세 빌드 지침][Example3]

![NVA, NSG 및 UDR이 있는 양방향 경계 네트워크][9]

#### 환경 설명
이 예제에는 다음을 포함하는 구독이 있습니다.

- 세 클라우드 서비스: "SecSvc001", "FrontEnd001", "BackEnd001"
- "SecNet", "FrontEnd", "BackEnd"의 세 서브넷을 포함하는 가상 네트워크 "CorpNetwork"
- 네트워크 가상 어플라이언스(이 예제의 경우 SecNet 서브넷에 연결된 방화벽)
- 응용 프로그램 웹 서버("IIS01")를 나타내는 Windows 서버
- 응용 프로그램 백 엔드 서버("AppVM01", "AppVM02")를 나타내는 두 Windows 서버
- DNS 서버("DNS01")를 나타내는 Windows Server

스크립트 및 Azure Resource Manager 템플릿은 [상세 빌드 지침][Example3]을 참조하세요.

#### UDR 설명
기본적으로 다음과 같은 시스템 경로는 다음으로 정의되어 있습니다.

        Effective routes : 
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.0.0/16}     VNETLocal                            Active   Default    
         {0.0.0.0/0}       Internet                             Active   Default    
         {10.0.0.0/8}      Null                                 Active   Default    
         {100.64.0.0/10}   Null                                 Active   Default    
         {172.16.0.0/12}   Null                                 Active   Default    
         {192.168.0.0/16}  Null                                 Active   Default

VNETLocal은 항상 특정 네트워크의 가상 네트워크에 대한 정의된 주소 접두사입니다(즉, 각각의 특정 가상 네트워크가 정의된 방식에 따라 가상 네트워크 간에 변경됨). 나머지 시스템 경로는 정적이며 기본값은 테이블과 같습니다.

이 예제에서는 프런트 엔드 및 백 엔드 서브넷당 하나씩, 두 개의 라우팅 테이블을 만듭니다. 각 테이블에는 지정된 서브넷에 적절한 정적 경로가 로드되어 있습니다. 이를 위해, 이 예에서는 각 테이블에 방화벽을 통해 모든 트래픽(0.0.0.0/0)을 지시하는 3개의 경로가 있습니다(다음 홉 = 가상 어플라이언스 IP 주소).

1. 로컬 서브넷 트래픽이 방화벽을 우회하도록 다음 홉이 정의되지 않은 로컬 서브넷 트래픽
2. 다음 홉이 방화벽으로 정의된 가상 네트워크 트래픽, 이 경우 로컬 가상 네트워크 트래픽이 직접 라우팅되도록 하는 기본 규칙을 재정의합니다.
3. 다음 홉이 방화벽으로 정의된 나머지 트래픽(0/0)

>[AZURE.TIP] UDR의 로컬 서브넷 항목이 없는 경우 로컬 서브넷 통신의 연결이 끊어집니다.
> - 이 예제에서 VNETLocal을 가리키는 10.0.1.0/24는 매우 중요합니다. 웹 서버(10.0.1.4)를 다른 로컬 서버(예: 10.0.1.25)에 보내는 패킷은 NVA에 전송되는 경우 실패합니다. 그러면 해당 패킷을 서브넷에 전송하고 서비넷은 NVA 등에 해당 패킷을 다시 전송합니다.
> - 라우팅 루프가 발생할 가능성은 일반적으로 통신하는 각 서브넷에 직접 연결된 다중 NIC 어플라이언스에서 더 높으며 이는 종종 기존의 온-프레미스 어플라이언스입니다.

라우팅 테이블이 생성되면 해당 서브넷에 바인딩됩니다. 프런트 엔드 서브넷 라우팅 테이블이 생성되어 서브넷에 바인딩되면 다음과 같습니다.

        Effective routes : 
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.1.0/24}     VNETLocal                            Active 
		 {10.0.0.0/16}     VirtualAppliance 10.0.0.4            Active    
         {0.0.0.0/0}       VirtualAppliance 10.0.0.4            Active

>[AZURE.NOTE] 이제 UDR은 ExpressRoute 회로가 연결된 게이트웨이 서브넷에 적용될 수 있습니다.
>
> Express 경로 또는 사이트 간 네트워킹에서 경계 네트워크를 사용하도록 설정하는 방법은 예제 3과 4에 설명되어 있습니다.


#### IP 전달 설명
IP 전달은 UDR의 도우미 기능입니다. IP 전달은 어플라이언스로 구체적 주소 지정이 되지 않은 트래픽을 수신한 다음 해당 트래픽을 최종 대상으로 전달할 수 있도록 하는 가상 어플라이언스의 설정입니다.

예를 들어 AppVM01에서 보낸 트래픽이 DNS01 서버에 요청할 경우 UDR이 이 요청을 방화벽으로 라우팅합니다. IP 전달을 사용하도록 설정한 경우 어플라이언스(10.0.0.4)에서 DNS01 대상(10.0.2.4)의 트래픽을 수락한 다음 최종 대상(10.0.2.4)으로 전달합니다. 방화벽에서 IP 전달을 사용하도록 설정하지 않은 경우에는 경로 테이블에 방화벽이 다음 홉으로 지정된 경우에도 어플라이언스에서 트래픽을 수락하지 않습니다. 가상 어플라이언스를 사용하려면 UDR과 연계하여 IP 전달을 사용하도록 설정하는 것이 중요합니다.

#### NSG 설명
이 예제에서는 NSG 그룹을 빌드한 후 단일 규칙을 로드합니다. 그런 다음 이 그룹을 프런트 엔드 및 백 엔드 서브넷에만 바인딩합니다(SecNet 제외). 선언적으로 다음 규칙을 빌드합니다.

- 인터넷에서 전체 가상 네트워크(모든 서브넷)으로 모든 트래픽(모든 포트) 거부됨

이 예제에서 NSG를 사용했지만 기본 목적은 수동 구성 시 실수가 발생할 경우를 대비하여 두 번째 방어 계층을 만드는 것입니다. 인터넷에서 프런트 엔드 또는 백 엔드 서브넷으로 보내는 모든 인바운드 트래픽을 차단하려고 합니다. 트래픽은 SecNet 서브넷에서 방화벽으로만 이동해야 합니다. 그런 다음 적절할 경우 프런트 엔드 또는 백 엔드 서브넷으로 이동할 수 있습니다. 또한 UDR 규칙을 적용할 경우 프런트 엔드 또는 백 엔드 서브넷으로 이동한 트래픽은 UDR 기능을 통해 방화벽으로 전달됩니다. 방화벽은 이러한 동작을 비대칭 흐름으로 보고 아웃바운드 트래픽을 삭제합니다. 따라서 서브넷을 보호하는 세 보안 계층이 있습니다.
- 1) FrontEnd001 및 BackEnd001 클라우드 서비스에는 열린 끝점이 없으며,
- 2) NSG는 인터넷 트래픽을 거부하며,
- 3) 방화벽은 비대칭 트래픽을 삭제합니다.

이 예제의 NSG에서 흥미로운 점 하나는 보안 서브넷을 포함한 전체 가상 네트워크에 대한 인터넷 트래픽을 거부하는 하나의 규칙만 포함되어 있다는 점입니다. 하지만 NSG가 프런트 엔드 및 백 엔드 서브넷에만 바인딩되어 있기 때문에 이 규칙은 보안 서브넷에 대한 인바운드 트래픽에서 처리되지 않습니다. 그 결과 트래픽이 보안 서브넷으로 이동합니다.

#### 방화벽 규칙
방화벽에서 전달 규칙을 만들어야 합니다. 방화벽은 모든 인바운드, 아웃바운드, 인트라-가상 네트워크 트래픽을 차단 또는 전달하기 때문에 많은 방화벽 규칙이 필요합니다. 또한 모든 인바운드 트래픽은 방화벽으로 처리하기 위해 다른 포트에 있는 보안 서비스 공용 IP 주소에 도달합니다. 나중에 재작업을 하지 않도록 서브넷 및 방화벽 규칙을 설정하기 전에 논리적 흐름을 다이어그램으로 그리는 것이 가장 좋습니다. 다음 그림은 이 예제의 방화벽 규칙을 논리적으로 나타낸 것입니다.
 
![방화벽 규칙에 대한 논리적 보기][10]

>[AZURE.NOTE] 관리 포트는 사용한 네트워크 가상 어플라이언스를 기준으로 달라집니다. 이 예제에서는 포트 22, 801, 807을 사용하는 Barracuda NextGen 방화벽을 참조합니다. 사용하는 장치 관리에 사용되는 정확한 포트를 찾으려면 어플라이언스 공급업체에서 제공한 설명서를 참조하세요.

#### 방화벽 규칙 설명
위의 논리적 다이어그램에는 보안 서브넷이 표시되어 있지 않습니다. 방화벽이 해당 서브넷의 유일한 리소스이기 때문입니다. 이 다이어그램은 방화벽 규칙과 이러한 방화벽 규칙이 실제 라우팅된 경로가 아닌 트래픽 흐름을 논리적으로 허용 또는 거부하는 방식을 보여 줍니다. 또한 RDP 트래픽에 선택된 외부 포트는 높은 범위의 포트(8014 – 8026)이며 쉽게 판독할 수 있도록 로컬 IP 주소의 마지막 두 8진수와 정렬하기 위해 선택된 것입니다(예: 로컬 서버 주소 10.0.1.4는 외부 포트 8014와 연결됨). 하지만 이보다 높으면서 충돌하지 않는 포트도 사용할 수 있습니다.

이 예제에서는 7가지 유형의 규칙이 필요합니다.

- 외부 규칙(인바운드 트래픽용):
  1.	방화벽 관리 규칙: 이 앱 리디렉션 규칙은 트래픽이 네트워크 가상 어플라이언스의 관리 포트로 전달되도록 허용합니다.
  2.	RDP 규칙(각 Windows Server용): 이 4가지 규칙(각 서버당 하나)은 RDP를 통한 개별 서버의 관리를 허용합니다. 이 규칙은 사용하는 네트워크 가상 어플라이언스의 기능에 따라 하나의 규칙으로 묶을 수 있습니다.
  3.	응용 프로그램 트래픽 규칙: 이러한 규칙에는 프런트 엔드 웹 트래픽용 규칙과 백 엔드 트래픽(예: 웹 서버에서 데이터 계층으로)용 규칙의 두 가지가 있습니다. 이러한 규칙은 서버를 배치하는 네트워크 아키텍처 및 트래픽 흐름(트래픽이 흐르는 방향, 사용하는 포트)에 따라 다르게 구성합니다.
      - 첫 번째 규칙은 실제 응용 프로그램 트래픽이 응용 프로그램 서버에 도달하도록 허용합니다. 다른 규칙은 보안, 관리 등을 허용하지만 응용 프로그램 규칙은 외부 사용자 또는 서비스가 응용 프로그램에 액세스하도록 허용하는 규칙입니다. 이 예제에서는 포트 80에 단일 웹 서버가 있으므로 단일 방화벽 응용 프로그램 규칙이 인바운드 트래픽을 외부 IP로 리디렉션한 다음 웹 서버의 내부 IP 주소로 리디렉션합니다. 리디렉션된 트래픽 세션은 NAT를 통해 내부 서버로 변환됩니다.
      - 두 번째 규칙은 웹 서버가 임의 포트를 통해 AppVM01 서버(AppVM02 제외)와 통신하도록 하는 백 엔드 규칙입니다.
- 내부 규칙(가상 네트워크 내부 트래픽용)
  4.	인터넷 아웃바운드 규칙: 이 규칙은 모든 네트워크의 트래픽이 선택한 네트워크로 전달되도록 허용합니다. 이 규칙은 일반적으로 방화벽에 이미 제공되어 있는 기본 규칙이지만 비활성화된 상태입니다. 이 예제에서는 이 규칙을 사용하도록 설정해야 합니다.
  5.	DNS 규칙: 이 규칙은 DNS(포트 53) 트래픽만 DNS 서버로 전달되도록 허용합니다. 이 환경에서는 프런트 엔드에서 백 엔드로 이동하는 대부분의 트래픽이 차단됩니다. 이 규칙은 로컬 서브넷의 DNS만 특별히 허용합니다.
  6.	서브넷 대 서브넷 규칙: 이 규칙은 백 엔드 서브넷의 모든 서버가 프런트 엔드 서브넷의 모든 서버에 연결할 수 있도록 허용합니다(그 반대의 경우는 거부).
- 유사 시 대기 규칙(위의 조건을 충족하지 않는 트래픽용):
  7.	모든 트래픽 거부 규칙: 이 규칙은 언제나 우선 순위 측면에서 마지막 규칙이 되어야 하며, 트래픽 흐름이 위의 규칙을 모두 충족하지 않을 경우 이 규칙에 의해 삭제됩니다. 이 규칙은 기본 규칙으로 일반적으로 활성화되어 있으며 수정이 필요하지 않는 경우가 대부분입니다.

>[AZURE.TIP] 두 번째 응용 프로그램 트래픽 규칙의 경우 이 예제에서는 쉬운 설명을 위해 모든 포트를 허용하지만, 실제 시나리오에서는 이 규칙의 공격 표면을 줄이기 위해 가장 구체적인 포트와 주소 범위를 사용해야 합니다.

위의 규칙을 만든 다음에는 각 규칙의 우선 순위를 검토하여 트래픽이 바라는 대로 허용 또는 거부되는지 확인하는 것이 중요합니다. 이 예제에서는 규칙이 우선 순위 순서로 나와 있습니다.

#### 결론
이것은 이전 예제보다 더 복잡하지만 더 완전한 네트워크 보호 및 격리 방법입니다. 예제 2에서는 응용 프로그램만 보호하고 예제 1에서는 서브넷만 격리했습니다. 이 설계에서는 양방향으로 트래픽을 모니터링하며 인바운드 응용 프로그램 서버를 보호할 뿐 아니라 해당 네트워크의 모든 서버에 대해 네트워크 보안 정책을 적용합니다. 또한 사용하는 어플라이언스에 따라 전체 트래픽 감사와 인지를 구현할 수 있습니다. 자세한 내용은 [상세 빌드 지침][Example3]을 참조하세요. 이러한 지침에는 다음이 포함됩니다.

- PowerShell 스크립트를 통해 이 예제 경계 네트워크를 빌드하는 방법
- Azure Resource Manager 템플릿을 사용하여 이 예제를 빌드하는 방법
- 각 UDR, NSG 명령 및 방화벽 규칙에 대한 상세 설명
- 각 계층에서의 트래픽 허용 또는 거부 방법을 나타내는 상세 트래픽 흐름 시나리오

### 예제 4: 사이트 간 가상 어플라이언스 VPN(가상 사설망)에 하이브리드 연결 추가
[빠른 시작으로 돌아가기](#fast-start) | 상세 빌드 지침 곧 제공

![NVA 연결 하이브리드 네트워크가 있는 경계 네트워크][11]

#### 환경 설명
NVA(네트워크 가상 어플라이언스)를 사용한 하이브리드 네트워킹은 예제 1, 2, 3에서 설명한 어느 경계 네트워크 유형에나 추가할 수 있습니다.

위의 그림에서 보듯이 인터넷을 통한 VPN 연결(사이트 간)을 사용하여 NVA를 통해 온-프레미스 네트워크를 Azure 가상 네트워크에 연결합니다.

>[AZURE.NOTE] Azure 공용 피어링 옵션을 활성화한 상태로 Express 경로를 사용할 경우 NVA VPN IP 주소를 Express 경로 WAN을 경유하지 않고 회사 인터넷까지 전달하기 위해 정적 경로를 만들어야 합니다. Express 경로 Azure 공용 피어링 옵션에 필요한 NAT가 VPN 세션을 차단할 수 있기 때문입니다.

VPN이 배치된 후에는 NVA가 모든 네트워크와 서브넷의 중앙 허브 역할을 합니다. 방화벽 전달 규칙은 허용하거나, NAT를 통해 변환하거나, 리디렉션하거나, 폐기할 트래픽 흐름을 결정합니다(온-프레미스 네트워크와 Azure 간의 트래픽 흐름인 경우에도 해당함).

트래픽 흐름은 특정 사용 사례에 따라 이 설계 패턴으로 최적화되거나 저하될 수 있으므로 신중한 고려가 필요합니다.

예제 3에서 구축한 환경을 사용하고 사이트 간 VPN 하이브리드 네트워크 연결을 추가하면 다음과 같은 설계가 됩니다.

![사이트 간 VPN을 통해 연결된 NVA가 있는 경계 네트워크][12]

온-프레미스 라우터 또는 기타 VPN용 NVA와 호환되는 네트워크 장치는 VPN 클라이언트입니다. 이 물리적 장치는 NVA와의 VPN 연결 시작 및 유지 관리를 담당합니다.

논리적으로 NVA에 대해, 네트워크는 영역 간 트래픽의 주 지시자 역할을 하는 NVA에 대한 규칙이 있는 4개의 개별 "보안 영역"처럼 보입니다.

![NVA 관점에서의 논리적 네트워크][13]

#### 결론
Azure 가상 네트워크에 대한 사이트 간 VPN 하이브리드 네트워크 연결을 추가하면 온-프레미스 네트워크를 Azure로 안전하게 확장할 수 있습니다. VPN 연결을 사용할 때는 트래픽이 암호화되어 인터넷을 통해 전달됩니다. 이 예제에서 NVA는 보안 정책을 적용 및 관리하는 중앙 위치를 제공합니다. 자세한 내용은 상세 빌드 지침(곧 제공)을 참조하세요. 이러한 지침에는 다음이 포함됩니다.

- PowerShell 스크립트를 통해 이 예제 경계 네트워크를 빌드하는 방법
- Azure Resource Manager 템플릿을 사용하여 이 예제를 빌드하는 방법
- 이 설계에서의 트래픽 흐름을 보여 주는 상세 트래픽 흐름 시나리오

### 예제 5: 사이트 간 Azure 게이트웨이 VPN을 통한 하이브리드 연결 추가
[빠른 시작으로 돌아가기](#fast-start) | 상세 빌드 지침 곧 제공

![게이트웨이 연결 하이브리드 네트워크가 있는 경계 네트워크][14]

#### 환경 설명
Azure VPN 게이트웨이를 사용한 하이브리드 네트워킹을 예제 1 또는 2에서 설명한 경계 네트워크 유형에 추가할 수 있습니다.

위의 그림에서 보듯이 인터넷을 통한 VPN 연결(사이트 간)을 사용하여 Azure VPN 게이트웨이를 통해 온-프레미스 네트워크를 Azure 가상 네트워크에 연결합니다.

>[AZURE.NOTE] Azure 공용 피어링 옵션을 활성화한 상태로 Express 경로를 사용할 경우 NVA VPN IP 주소를 Express 경로 WAN을 경유하지 않고 회사 인터넷까지 전달하기 위해 정적 경로를 만들어야 합니다. Express 경로 Azure 공용 피어링 옵션에 필요한 NAT가 VPN 세션을 차단할 수 있기 때문입니다.

아래 그림에 나와 있듯이 이 옵션에는 두 개의 네트워크 가장자리가 있습니다. 첫 번째 가장자리에서는 NVA와 NSG가 Azure 네트워크 내부의 트래픽 흐름 및 Azure와 인터넷 간의 트래픽 흐름을 제어하며, 두 번째 가장자리는 온-프레미스와 Azure 간에 완전히 분리 및 격리된 네트워크 가장자리인 Azure VPN 게이트웨이입니다.

트래픽 흐름은 특정 사용 사례에 따라 이 설계 패턴으로 최적화되거나 저하될 수 있으므로 신중한 고려가 필요합니다.

예제 1에서 구축한 환경을 사용하고 사이트 간 VPN 하이브리드 네트워크 연결을 추가하면 다음과 같은 설계가 됩니다.

![Express 경로 연결을 통해 게이트웨이에 연결된 경계 네트워크][15]

#### 결론
Azure 가상 네트워크에 대한 사이트 간 VPN 하이브리드 네트워크 연결을 추가하면 온-프레미스 네트워크를 Azure로 안전하게 확장할 수 있습니다. 기본 Azure VPN 게이트웨이를 사용하면 트래픽이 IPSec 암호화되며 인터넷을 통해 전달됩니다. 또한 Azure VPN 게이트웨이 사용이 더 저렴한 옵션이 될 수 있습니다(타사 NVA 사용에 따른 추가적인 라이선스 비용이 없음). NVA를 사용하지 않는 예제 1에서는 가장 경제적인 옵션입니다. 자세한 내용은 상세 빌드 지침(곧 제공)을 참조하세요. 이러한 지침에는 다음이 포함됩니다.

- PowerShell 스크립트를 통해 이 예제 경계 네트워크를 빌드하는 방법
- Azure Resource Manager 템플릿을 사용하여 이 예제를 빌드하는 방법
- 이 설계에서의 트래픽 흐름을 보여 주는 상세 트래픽 흐름 시나리오

### 예제 6: Express 경로를 통한 하이브리드 연결 추가
[빠른 시작으로 돌아가기](#fast-start) | 상세 빌드 지침 곧 제공

![게이트웨이 연결 하이브리드 네트워크가 있는 경계 네트워크][16]

#### 환경 설명
Express 경로 사설 피어링 연결을 사용한 하이브리드 네트워킹은 예제 1 또는 2에서 설명한 경계 네트워크 유형에 추가할 수 있습니다.

위의 그림에서처럼 Express 경로 사설 피어링은 온-프레미스 네트워크와 Azure 가상 네트워크 간의 직접 연결을 제공합니다. 트래픽은 서비스 공급자 네트워크와 Microsoft Azure 네트워크만을 통과하며 인터넷에는 접촉하지 않습니다.

>[AZURE.NOTE] Azure 가상 게이트웨이에서 사용되는 동적 라우팅의 복잡성으로 인해 UDR을 Express 경로와 함께 사용하는 경우 특정 제한 사항이 있습니다. 다음과 같습니다.
>
>- UDR은 Express 경로에 연결된 Azure 가상 게이트웨이가 연결된 게이트웨이 서브넷에 적용될 수 없습니다.
>- Express 경로에 연결된 Azure 가상 게이트웨이는 UDR에 바인딩된 다른 서브넷에 대한 NextHop 장치가 될 수 없습니다.
>
>
<br />

>[AZURE.TIP] Express 경로를 사용하면 기업 네트워크 트래픽을 인터넷과 분리하여 보안을 높일 수 있으며 성능이 크게 증대되고 Express 경로 공급자가 제공하는 서비스 수준 계약이 가능합니다. Azure 게이트웨이는 Express 경로를 통해 최대 2Gb/s를 전달할 수 있습니다. 사이트 간 VPN의 경우 Azure 게이트웨이 최대 처리량은 200Mb/s입니다.

다음 다이어그램과 같이, 이 옵션을 적용하면 환경에 두 네트워크 가장자리가 있습니다. NVA와 NSG는 Azure 네트워크 내부의 트래픽 흐름 및 Azure와 인터넷 간의 트래픽 흐름을 제어하는 반면, 게이트웨이는 온-프레미스와 Azure 간에 완전히 분리 및 격리된 네트워크 가장자리입니다.

트래픽 흐름은 특정 사용 사례에 따라 이 설계 패턴으로 최적화되거나 저하될 수 있으므로 신중한 고려가 필요합니다.

예제 1에서 구축한 환경을 사용하고 Express 경로 하이브리드 네트워크 연결을 추가하면 다음과 같은 설계가 됩니다.

![Express 경로 연결을 통해 게이트웨이에 연결된 경계 네트워크][17]

#### 결론
Express 경로 사설 피어링 네트워크 연결을 추가하면 안전하며 대기 시간이 적고 성능을 높은 방법으로 온-프레미스 네트워크를 Azure로 확장할 수 있습니다. 또한 이 예에서처럼 기본 Azure 게이트웨이 사용이 더 저렴한 옵션이 될 수 있습니다(타사 NVA 사용에 따른 추가적인 라이선스 비용이 없음). 자세한 내용은 상세 빌드 지침(곧 제공)을 참조하세요. 이러한 지침에는 다음이 포함됩니다.

- PowerShell 스크립트를 통해 이 예제 경계 네트워크를 빌드하는 방법
- Azure Resource Manager 템플릿을 사용하여 이 예제를 빌드하는 방법
- 이 설계에서의 트래픽 흐름을 보여 주는 상세 트래픽 흐름 시나리오

## 참조
### 유용한 웹 사이트 및 설명서
- Azure Resource Manager를 사용하여 Azure 액세스:
- PowerShell 통한 Azure 액세스: [https://azure.microsoft.com/documentation/articles/powershell-install-configure/](./powershell-install-configure.md)
- 가상 네트워킹 설명서: [https://azure.microsoft.com/documentation/services/virtual-network/](https://azure.microsoft.com/documentation/services/virtual-network/)
- 가상 네트워킹 그룹 설명서: [https://azure.microsoft.com/documentation/articles/virtual-networks-nsg/](./virtual-network/virtual-networks-nsg.md)
- 사용자 정의 라우팅 설명서: [https://azure.microsoft.com/documentation/articles/virtual-networks-udr-overview/](./virtual-network/virtual-networks-udr-overview.md)
- Azure 가상 게이트웨이: [https://azure.microsoft.com/documentation/services/vpn-gateway/](https://azure.microsoft.com/documentation/services/vpn-gateway/)
- 사이트 간 VPN: [https://azure.microsoft.com/documentation/articles/vpn-gateway-create-site-to-site-rm-powershell](./vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md)
- ExpressRoute 설명서("시작하기" 및 "방법" 섹션 확인): [https://azure.microsoft.com/documentation/services/expressroute/](https://azure.microsoft.com/documentation/services/expressroute/)

<!--Image References-->
[0]: ./media/best-practices-network-security/flowchart.png "보안 옵션 순서도"
[1]: ./media/best-practices-network-security/compliancebadges.png "Azure 규정 준수 배지"
[2]: ./media/best-practices-network-security/azuresecurityfeatures.png "Azure 보안 기능"
[3]: ./media/best-practices-network-security/dmzcorporate.png "회사 네트워크의 DMZ"
[4]: ./media/best-practices-network-security/azuresecurityarchitecture.png "Azure 보안 아키텍처"
[5]: ./media/best-practices-network-security/dmzazure.png "Azure 가상 네트워크의 DMZ"
[6]: ./media/best-practices-network-security/dmzhybrid.png "3개의 보안 경계가 있는 하이브리드 네트워크"
[7]: ./media/best-practices-network-security/example1design.png "NSG와 인바운드 DMZ"
[8]: ./media/best-practices-network-security/example2design.png "NVA 및 NSG와 인바운드 DMZ"
[9]: ./media/best-practices-network-security/example3design.png "NVA, NSG, UDR을 사용하는 양방향 DMZ"
[10]: ./media/best-practices-network-security/example3firewalllogical.png "방화벽 규칙에 대한 논리적 보기"
[11]: ./media/best-practices-network-security/example4designoptions.png "NVA 연결 하이브리드 네트워크가 있는 DMZ"
[12]: ./media/best-practices-network-security/example4designs2s.png "사이트 간 VPN을 통해 연결된 NVA가 있는 DMZ"
[13]: ./media/best-practices-network-security/example4networklogical.png "NVA 관점에서의 논리적 네트워크"
[14]: ./media/best-practices-network-security/example5designoptions.png "사이트 간 하이브리드 네트워크를 통해 Azure 게이트웨이에 연결된 DMZ"
[15]: ./media/best-practices-network-security/example5designs2s.png "사이트 간 VPN을 사용하는 Azure 게이트웨이가 있는 DMZ"
[16]: ./media/best-practices-network-security/example6designoptions.png "Azure 게이트웨이 연결 Express 경로 하이브리드 네트워크가 있는 DMZ"
[17]: ./media/best-practices-network-security/example6designexpressroute.png "Express 경로 연결을 사용하는 Azure 게이트웨이가 있는 DMZ"

<!--Link References-->
[Example1]: ./virtual-network/virtual-networks-dmz-nsg-asm.md
[Example2]: ./virtual-network/virtual-networks-dmz-nsg-fw-asm.md
[Example3]: ./virtual-network/virtual-networks-dmz-nsg-fw-udr-asm.md
[Example4]: ./virtual-network/virtual-networks-hybrid-s2s-nva-asm.md
[Example5]: ./virtual-network/virtual-networks-hybrid-s2s-agw-asm.md
[Example6]: ./virtual-network/virtual-networks-hybrid-expressroute-asm.md
[Example7]: ./virtual-network/virtual-networks-vnet2vnet-direct-asm.md
[Example8]: ./virtual-network/virtual-networks-vnet2vnet-transit-asm.md

<!---HONumber=AcomDC_0921_2016-->